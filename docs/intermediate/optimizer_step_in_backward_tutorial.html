
<!DOCTYPE html>


<html lang="ko" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="article:modified_time" content="2024-06-09T15:35:40+00:00" /><meta property="og:title" content="옵티마이저 단계를 backward pass에 합쳐서 메모리 절약하기" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tutorials.pytorch.kr/intermediate/optimizer_step_in_backward_tutorial.html" />
<meta property="og:site_name" content="PyTorch Tutorials KR" />
<meta property="og:description" content="번역: 하동훈 안녕하세요! 이 튜토리얼에서는 변화도(gradient) 가 차지하는 메모리를 줄임으로써 학습 루프(training loop)에서의 메모리 사용량을 줄이는 한 가지 방법을 소개합니다. 모델이 있는 상황에서 메모리 최적화를 통해 메모리 부족(Out of Memory, OOM) 오류를 방지하고 싶거나, GPU의 성능을 최대한 활용하고 싶은 경우 이 방법이 도움이 될 수 있습니다 (변화도가 메모리의 일부분을 차지하고 있으며, 변화도 누적(accumulation)이 필요하지 않은 경우라면 말입니다). 이 튜토리얼은 다음 ..." />
<meta property="og:image" content="https://tutorials.pytorch.kr/_static/logos/logo-kr-sm-dark.png" />
<meta property="og:image:alt" content="PyTorch Tutorials KR" />
<meta name="description" content="번역: 하동훈 안녕하세요! 이 튜토리얼에서는 변화도(gradient) 가 차지하는 메모리를 줄임으로써 학습 루프(training loop)에서의 메모리 사용량을 줄이는 한 가지 방법을 소개합니다. 모델이 있는 상황에서 메모리 최적화를 통해 메모리 부족(Out of Memory, OOM) 오류를 방지하고 싶거나, GPU의 성능을 최대한 활용하고 싶은 경우 이 방법이 도움이 될 수 있습니다 (변화도가 메모리의 일부분을 차지하고 있으며, 변화도 누적(accumulation)이 필요하지 않은 경우라면 말입니다). 이 튜토리얼은 다음 ..." />
<meta property="og:ignore_canonical" content="true" />

    <title>옵티마이저 단계를 backward pass에 합쳐서 메모리 절약하기 &#8212; 파이토치 한국어 튜토리얼 (PyTorch tutorials in Korean)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=536c50fe" />
    <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=4d2595e5" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pytorch_theme.css?v=c326296f" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=097efa9c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom2.css?v=b169ea90" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=725a5b95"></script>
    <script src="../_static/doctools.js?v=92e14aea"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/translations.js?v=b5f768d8"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'intermediate/optimizer_step_in_backward_tutorial';</script>
    <link rel="canonical" href="https://tutorials.pytorch.kr/intermediate/optimizer_step_in_backward_tutorial.html" />
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="색인" href="../genindex.html" />
    <link rel="search" title="검색" href="../search.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ko"/>
    <meta name="docbuild:last-update" content="2024년 06월 09일"/>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>
<script>
  if (window.location.hostname === 'docs.pytorch.org' || window.location.hostname === 'docs-preview.pytorch.org') {
    const script = document.createElement('script');
    script.src = 'https://cmp.osano.com/16A0DbT9yDNIaQkvZ/31b1b91a-e0b6-47ea-bde2-7f2bd13dbe5c/osano.js?variant=one';
    document.head.appendChild(script);
  }
</script>
<script>
  // Cookie banner for non-LF projects
  document.addEventListener('DOMContentLoaded', function () {
    // Hide cookie banner on local environments and LF owned docs
    if (window.location.hostname === 'localhost' ||
      window.location.hostname === '0.0.0.0' ||
      window.location.hostname === '127.0.0.1' ||
      window.location.hostname === 'docs.pytorch.org' ||
      window.location.hostname === 'docs-preview.pytorch.org' ||
      window.location.hostname.startsWith('192.168.')) {
      const banner = document.querySelector('.cookie-banner-wrapper');
      if (banner) {
        banner.style.display = 'none';
      }
    }
  });
</script>
<!-- Conditional CSS for header and footer height adjustment -->

<link rel="stylesheet" type="text/css" href="../_static/css/theme.css" crossorigin="anonymous">
<script type="text/javascript" src="../_static/js/theme.js"></script>
<script type="text/javascript" src="../_static/js/dropdown-menu.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Nanum+Gothic+Coding:wght@400;700&family=Montserrat:wght@300;400&display=swap" rel="stylesheet">
<meta property="og:image" content="../_static/img/pytorch_seo.png" />
<link rel="stylesheet" href="../_static/webfonts/all.min.css" crossorigin="anonymous">
<meta http-equiv="Content-Security-Policy"
  content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval' blob:;">
<meta name="pytorch_project" content="tutorials">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-LZRD6GXDLF" height="0" width="0"
    style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<!-- Google Tag Manager -->
<script>(function (w, d, s, l, i) {
    w[l] = w[l] || []; w[l].push({
      'gtm.start':
        new Date().getTime(), event: 'gtm.js'
    }); var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
        'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    j.onload = function () {
      window.dispatchEvent(new Event('gtm_loaded'));
      console.log('GTM loaded successfully');
    };
  })(window, document, 'script', 'dataLayer', 'G-LZRD6GXDLF');
</script>
<!-- End Google Tag Manager -->
<!-- Facebook Pixel Code -->
<script>
  !function (f, b, e, v, n, t, s) {
    if (f.fbq) return; n = f.fbq = function () {
      n.callMethod ?
        n.callMethod.apply(n, arguments) : n.queue.push(arguments)
    };
    if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
    n.queue = []; t = b.createElement(e); t.async = !0;
    t.src = v; s = b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t, s)
  }(window, document, 'script',
    'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '243028289693773');
  fbq('track', 'PageView');
</script>
<script>
  document.documentElement.setAttribute('data-version', 'v2.8.0+cu128');
</script>
<noscript>
  <img height="1" width="1" src="https://www.facebook.com/tr?id=243028289693773&ev=PageView&noscript=1" />
</noscript>
<script>
  function gtag() {
    window.dataLayer.push(arguments);
  }
</script>
<!-- End Facebook Pixel Code -->
<!-- Script to Fix scrolling -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Fix anchor scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          const headerHeight =
            (document.querySelector('.header-holder') ? document.querySelector('.header-holder').offsetHeight : 0) +
            (document.querySelector('.bd-header') ? document.querySelector('.bd-header').offsetHeight : 0) + 20;

          const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - headerHeight;
          window.scrollTo({
            top: targetPosition,
            behavior: 'smooth'
          });

          // Update URL hash without scrolling
          history.pushState(null, null, '#' + targetId);
        }
      });
    });
  });
</script>

<script async src="https://cse.google.com/cse.js?cx=e65585f8c3ea1440e"></script>


  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ko"/>
    <meta name="docbuild:last-update" content="2024년 06월 09일"/>

  </head>

<body data-feedback-url="https://github.com/PyTorchKorea/tutorials-kr" class="pytorch-body">
  
    <div class="container-fluid header-holder tutorials-header" id="header-holder">
   <div class="header-container-wrapper">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.kr/" aria-label="PyTorchKR"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="learnDropdownButton" data-toggle="learn-dropdown" class="learn-dropdown">
              <a class="with-down-arrow">
                <span>배우기</span>
              </a>
              <div class="learn-dropdown-menu dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.kr/get-started/locally/">
                  <span class="dropdown-title">PyTorch 시작하기</span>
                </a>
                <a class="nav-dropdown-item" href="https://tutorials.pytorch.kr/beginner/basics/intro.html">
                  <span class="dropdown-title">기본 익히기</span>
                </a>
                <a class="nav-dropdown-item" href="https://tutorials.pytorch.kr/" target="_self">
                  <span class="dropdown-title">한국어 튜토리얼</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.kr/hub/">
                  <span class="dropdown-title">한국어 모델 허브</span>
                </a>
                <a class="nav-dropdown-item" href="https://docs.pytorch.org/tutorials/" target="_blank">
                  <span class="dropdown-title">Official Tutorials</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <a href="https://pytorch.kr/blog/">
              <span>블로그</span>
            </a>
          </li>

          <li class="main-menu-item">
          <div id="docsDropdownButton" data-toggle="docs-dropdown" class="docs-dropdown">
              <a class="with-down-arrow">
              <span>문서</span>
              </a>
              <div class="docs-dropdown-menu dropdown-menu">
                <a class="nav-dropdown-item" href="https://docs.pytorch.org/docs/" target="_blank">
                  <span class="dropdown-title">PyTorch API</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.kr/domains/">
                  <span class="dropdown-title">Domain API 소개</span>
                </a>
                <a class="nav-dropdown-item" href="https://tutorials.pytorch.kr/" target="_self">
                  <span class="dropdown-title">한국어 튜토리얼</span>
                </a>
                <a class="nav-dropdown-item" href="https://docs.pytorch.org/tutorials/" target="_blank">
                  <span class="dropdown-title">Official Tutorials</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
          <div id="communityDropdownButton" data-toggle="community-dropdown" class="community-dropdown">
              <a class="with-down-arrow">
              <span>커뮤니티</span>
              </a>
              <div class="community-dropdown-menu dropdown-menu">
                <a class="nav-dropdown-item" href="https://discuss.pytorch.kr/" target="_self">
                  <span class="dropdown-title">한국어 커뮤니티</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.kr/resources/">
                  <span class="dropdown-title">개발자 정보</span>
                </a>
                <a class="nav-dropdown-item" href="https://landscape.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Landscape</span>
                </a>
              </div>
            </div>
          </li>

        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu">
        <i class="fa-solid fa-ellipsis"></i>
      </a>
    </div>
  </div>
 </div>

 <!-- Begin Mobile Menu -->

<div class="mobile-main-menu">
  <div class="container-fluid">
    <div class="header-container-wrapper">
      <div class="mobile-main-menu-header-container">
        <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu">
          <i class="fa-solid fa-xmark"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="mobile-main-menu-links-container">
    <div class="main-menu">
      <ul>
         <li class="resources-mobile-menu-title">
           <a>배우기</a>
         </li>
         <ul class="resources-mobile-menu-items">
           <li>
             <a href="https://pytorch.kr/get-started/locally/">PyTorch 시작하기</a>
           </li>
           <li>
             <a href="https://tutorials.pytorch.kr/beginner/basics/intro.html">기본 익히기</a>
           </li>
           <li>
             <a href="https://tutorials.pytorch.kr/">한국어 튜토리얼</a>
           </li>
           <li>
             <a href="https://pytorch.kr/hub/">한국어 모델 허브</a>
           </li>
           <li>
             <a href="https://docs.pytorch.org/tutorials/" target="_blank">Official Tutorials</a>
           </li>
        </ul>
         <li class="resources-mobile-menu-title">
           <a href="https://pytorch.kr/blog/">블로그</a>
         </li>
         <li class="resources-mobile-menu-title">
           <a>문서</a>
         </li>
         <ul class="resources-mobile-menu-items">
          <li>
            <a href="https://docs.pytorch.org/docs/" target="_blank">PyTorch API</a>
          </li>
          <li>
            <a href="https://pytorch.kr/domains/">Domain API 소개</a>
          </li>
          <li>
            <a href="https://tutorials.pytorch.kr/">한국어 튜토리얼</a>
          </li>
          <li>
            <a href="https://docs.pytorch.org/tutorials/" target="_blank">Official Tutorials</a>
          </li>
        </ul>
        <li class="resources-mobile-menu-title">
          <a>커뮤니티</a>
        </li>
         <ul class="resources-mobile-menu-items">
          <li>
            <a href="https://discuss.pytorch.kr/">한국어 커뮤니티</a>
          </li>
          <li>
            <a href="https://pytorch.kr/resources/">개발자 정보</a>
          </li>
          <li>
            <a href="https://landscape.pytorch.org/" target="_blank">Landscape</a>
          </li>
        </ul>
      </ul>
    </div>
  </div>
</div>

<!-- End Mobile Menu -->
  
  
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">
  <a href="../index.html" class="version">v2.8.0+cu128</a>
</div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../intro.html">
    Intro
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../compilers_index.html">
    Compilers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../domains.html">
    Domains
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../distributed.html">
    Distributed
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../deep-dive.html">
    Deep Dive
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../extension.html">
    Extension
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../ecosystem.html">
    Ecosystem
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../recipes_index.html">
    Recipes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">
<div class="search-container-wrapper">
  <div id="sphinx-search" class="search-container">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </div>

  <div id="google-search" class="search-container" style="display:none;">
    <div class="gcse-search-wrapper">
      <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
      <div class="gcse-search"></div>
    </div>
  </div>

  <div class="search-toggle-container" data-bs-title="Google Search Off" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <div class="search-toggle-inner">
      <label class="switch">
        <input type="checkbox" id="search-toggle">
        <span class="slider round"></span>
      </label>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
  // Define the search callback
  const myWebSearchStartingCallback = (gname, query) => {
    if (typeof dataLayer !== 'undefined' && query) {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'google_search',
        'search_term': query,
        'event_category': 'Search',
        'event_label': 'Google Search'
      });
    }
    return '';
  };

  // Set up the GCSE search callbacks
  window.__gcse || (window.__gcse = {});
  window.__gcse.searchCallbacks = {
    web: { starting: myWebSearchStartingCallback }
  };

  if (window.location.pathname.includes('/search.html')) {
    document.body.classList.add('search-page');
  }

  // Function to reinitialize Google CSE
  function reinitializeGoogleSearch() {
    if (window.__gcse && window.__gcse.initializationCallback) {
      window.__gcse.initializationCallback();
    }
  }

  // Function to handle search toggle
  function handleSearchToggle(toggle, sphinxSearch, googleSearch) {
    if (!toggle || !sphinxSearch || !googleSearch) return;

    // Check if the URL contains /stable/ or /tutorials/
    const currentUrl = window.location.href;
    // TODO: We've had reports that the google programmable search is returning stale documentation,
    //       Simple reproduction is to turn google search on and search for multinomial which will
    //       result in returning 1.8.1 documentation.
    //       We should turn this back on when we resolve that bug.
    const shouldDefaultToGoogle = false;
    const savedPreference = localStorage.getItem('searchPreference');

    // Set initial state
    if (savedPreference === 'google' || (savedPreference === null && shouldDefaultToGoogle)) {
      toggle.checked = true;
      sphinxSearch.style.display = 'none';
      googleSearch.style.display = 'block';
      if (savedPreference === null) {
        localStorage.setItem('searchPreference', 'google');
      }
      reinitializeGoogleSearch();
    } else {
      toggle.checked = false;
      sphinxSearch.style.display = 'block';
      googleSearch.style.display = 'none';
    }

    // Update tooltip
    updateTooltip(toggle.checked);

    // Skip if already initialized
    if (toggle.hasAttribute('data-initialized')) return;
    toggle.setAttribute('data-initialized', 'true');

    toggle.addEventListener('change', function() {
      if (this.checked) {
        sphinxSearch.style.display = 'none';
        googleSearch.style.display = 'block';
        localStorage.setItem('searchPreference', 'google');
        reinitializeGoogleSearch();
        trackSearchEngineSwitch('Google');
      } else {
        sphinxSearch.style.display = 'block';
        googleSearch.style.display = 'none';
        localStorage.setItem('searchPreference', 'sphinx');
        trackSearchEngineSwitch('Sphinx');
      }

      updateTooltip(this.checked);
      updateMobileSearch();
    });
  }

  // Update tooltip based on toggle state
  function updateTooltip(isChecked) {
    const tooltipElement = document.querySelector('.search-toggle-container');
    if (!tooltipElement) return;

    tooltipElement.setAttribute('data-bs-title', isChecked ? 'Google Search On' : 'Google Search Off');

    if (bootstrap && bootstrap.Tooltip) {
      const tooltipInstance = bootstrap.Tooltip.getInstance(tooltipElement);
      if (tooltipInstance) tooltipInstance.dispose();
      new bootstrap.Tooltip(tooltipElement);
    }
  }

  // Track search engine switch
  function trackSearchEngineSwitch(engine) {
    if (typeof dataLayer !== 'undefined') {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'search_engine_switch',
        'event_category': 'Search',
        'event_label': engine
      });
    }
  }

  // Function to update mobile search based on current toggle state
  function updateMobileSearch() {
    const toggle = document.getElementById('search-toggle');
    if (!toggle) return;

    const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
    if (!mobileSearchContainer) return;

    const mobileSphinxSearch = mobileSearchContainer.querySelector('#sphinx-search');
    const mobileGoogleSearch = mobileSearchContainer.querySelector('#google-search');

    if (mobileSphinxSearch && mobileGoogleSearch) {
      mobileSphinxSearch.style.display = toggle.checked ? 'none' : 'block';
      mobileGoogleSearch.style.display = toggle.checked ? 'block' : 'none';

      if (toggle.checked) {
        reinitializeGoogleSearch();
      }
    }
  }

  // Initialize desktop search toggle
  const toggle = document.getElementById('search-toggle');
  const sphinxSearch = document.getElementById('sphinx-search');
  const googleSearch = document.getElementById('google-search');
  handleSearchToggle(toggle, sphinxSearch, googleSearch);

  // Set placeholder text for Google search input
  const observer = new MutationObserver(function() {
    document.querySelectorAll('.gsc-input input').forEach(input => {
      if (input && !input.hasAttribute('data-placeholder-set')) {
        input.setAttribute('placeholder', 'Search the docs ...');
        input.setAttribute('data-placeholder-set', 'true');
      }
    });
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // Fix for scroll jump issue - improved approach
  function setupSearchInputHandlers(input) {
    if (input.hasAttribute('data-scroll-fixed')) return;
    input.setAttribute('data-scroll-fixed', 'true');

    let lastScrollPosition = 0;
    let isTyping = false;
    let scrollTimeout;

    // Save position before typing starts
    input.addEventListener('keydown', () => {
      lastScrollPosition = window.scrollY;
      isTyping = true;

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);
    });

    // Only maintain scroll position during typing
    function maintainScroll() {
      if (document.activeElement === input && isTyping) {
        window.scrollTo(0, lastScrollPosition);
        requestAnimationFrame(maintainScroll);
      }
    }

    input.addEventListener('focus', () => {
      // Just store initial position but don't force it
      lastScrollPosition = window.scrollY;
    });

    input.addEventListener('input', () => {
      isTyping = true;
      window.scrollTo(0, lastScrollPosition);

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);

      requestAnimationFrame(maintainScroll);
    });
  }

  // Apply to all search inputs and observe for new ones
  function applyToSearchInputs() {
    document.querySelectorAll('.search-container input, .gsc-input input').forEach(setupSearchInputHandlers);
  }

  applyToSearchInputs();

  const searchObserver = new MutationObserver(applyToSearchInputs);
  searchObserver.observe(document.body, { childList: true, subtree: true });

  // Watch for mobile menu creation
  const mobileMenuObserver = new MutationObserver(function(mutations) {
    for (const mutation of mutations) {
      if (!mutation.addedNodes.length) continue;

      // Style mobile search inputs
      document.querySelectorAll('.sidebar-header-items__end .navbar-item .search-container-wrapper .gsc-input input').forEach(input => {
        if (input) {
          input.setAttribute('placeholder', 'Search the docs ...');
          input.style.paddingLeft = '36px';
        }
      });

      // Check for mobile search container
      const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
      if (!mobileSearchContainer) continue;

      const mobileToggle = mobileSearchContainer.querySelector('#search-toggle');
      if (mobileToggle && toggle) {
        // Sync mobile toggle with desktop toggle
        mobileToggle.checked = toggle.checked;
        updateMobileSearch();

        // Add event listener to mobile toggle if not already added
        if (!mobileToggle.hasAttribute('data-initialized')) {
          mobileToggle.setAttribute('data-initialized', 'true');
          mobileToggle.addEventListener('change', function() {
            // Sync desktop toggle with mobile toggle
            toggle.checked = this.checked;
            // Trigger change event on desktop toggle to update both
            toggle.dispatchEvent(new Event('change'));
          });
        }
      }
    }
  });

  mobileMenuObserver.observe(document.body, { childList: true, subtree: true });

  // Ensure Google CSE is properly loaded
  if (window.__gcse) {
    window.__gcse.callback = function() {
      // This will run after Google CSE is fully loaded
      if (toggle && toggle.checked) {
        reinitializeGoogleSearch();
      }
    };
  } else {
    window.__gcse = {
      callback: function() {
        if (toggle && toggle.checked) {
          reinitializeGoogleSearch();
        }
      }
    };
  }
});
</script>
</div>
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PyTorchKorea/tutorials-kr" title="한국어 튜토리얼 GitHub 저장소" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">한국어 튜토리얼 GitHub 저장소</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discuss.pytorch.kr/" title="파이토치 한국어 커뮤니티" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">파이토치 한국어 커뮤니티</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../intro.html">
    Intro
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../compilers_index.html">
    Compilers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../domains.html">
    Domains
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../distributed.html">
    Distributed
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../deep-dive.html">
    Deep Dive
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../extension.html">
    Extension
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../ecosystem.html">
    Ecosystem
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../recipes_index.html">
    Recipes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="search-container-wrapper">
  <div id="sphinx-search" class="search-container">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </div>

  <div id="google-search" class="search-container" style="display:none;">
    <div class="gcse-search-wrapper">
      <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
      <div class="gcse-search"></div>
    </div>
  </div>

  <div class="search-toggle-container" data-bs-title="Google Search Off" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <div class="search-toggle-inner">
      <label class="switch">
        <input type="checkbox" id="search-toggle">
        <span class="slider round"></span>
      </label>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
  // Define the search callback
  const myWebSearchStartingCallback = (gname, query) => {
    if (typeof dataLayer !== 'undefined' && query) {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'google_search',
        'search_term': query,
        'event_category': 'Search',
        'event_label': 'Google Search'
      });
    }
    return '';
  };

  // Set up the GCSE search callbacks
  window.__gcse || (window.__gcse = {});
  window.__gcse.searchCallbacks = {
    web: { starting: myWebSearchStartingCallback }
  };

  if (window.location.pathname.includes('/search.html')) {
    document.body.classList.add('search-page');
  }

  // Function to reinitialize Google CSE
  function reinitializeGoogleSearch() {
    if (window.__gcse && window.__gcse.initializationCallback) {
      window.__gcse.initializationCallback();
    }
  }

  // Function to handle search toggle
  function handleSearchToggle(toggle, sphinxSearch, googleSearch) {
    if (!toggle || !sphinxSearch || !googleSearch) return;

    // Check if the URL contains /stable/ or /tutorials/
    const currentUrl = window.location.href;
    // TODO: We've had reports that the google programmable search is returning stale documentation,
    //       Simple reproduction is to turn google search on and search for multinomial which will
    //       result in returning 1.8.1 documentation.
    //       We should turn this back on when we resolve that bug.
    const shouldDefaultToGoogle = false;
    const savedPreference = localStorage.getItem('searchPreference');

    // Set initial state
    if (savedPreference === 'google' || (savedPreference === null && shouldDefaultToGoogle)) {
      toggle.checked = true;
      sphinxSearch.style.display = 'none';
      googleSearch.style.display = 'block';
      if (savedPreference === null) {
        localStorage.setItem('searchPreference', 'google');
      }
      reinitializeGoogleSearch();
    } else {
      toggle.checked = false;
      sphinxSearch.style.display = 'block';
      googleSearch.style.display = 'none';
    }

    // Update tooltip
    updateTooltip(toggle.checked);

    // Skip if already initialized
    if (toggle.hasAttribute('data-initialized')) return;
    toggle.setAttribute('data-initialized', 'true');

    toggle.addEventListener('change', function() {
      if (this.checked) {
        sphinxSearch.style.display = 'none';
        googleSearch.style.display = 'block';
        localStorage.setItem('searchPreference', 'google');
        reinitializeGoogleSearch();
        trackSearchEngineSwitch('Google');
      } else {
        sphinxSearch.style.display = 'block';
        googleSearch.style.display = 'none';
        localStorage.setItem('searchPreference', 'sphinx');
        trackSearchEngineSwitch('Sphinx');
      }

      updateTooltip(this.checked);
      updateMobileSearch();
    });
  }

  // Update tooltip based on toggle state
  function updateTooltip(isChecked) {
    const tooltipElement = document.querySelector('.search-toggle-container');
    if (!tooltipElement) return;

    tooltipElement.setAttribute('data-bs-title', isChecked ? 'Google Search On' : 'Google Search Off');

    if (bootstrap && bootstrap.Tooltip) {
      const tooltipInstance = bootstrap.Tooltip.getInstance(tooltipElement);
      if (tooltipInstance) tooltipInstance.dispose();
      new bootstrap.Tooltip(tooltipElement);
    }
  }

  // Track search engine switch
  function trackSearchEngineSwitch(engine) {
    if (typeof dataLayer !== 'undefined') {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'search_engine_switch',
        'event_category': 'Search',
        'event_label': engine
      });
    }
  }

  // Function to update mobile search based on current toggle state
  function updateMobileSearch() {
    const toggle = document.getElementById('search-toggle');
    if (!toggle) return;

    const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
    if (!mobileSearchContainer) return;

    const mobileSphinxSearch = mobileSearchContainer.querySelector('#sphinx-search');
    const mobileGoogleSearch = mobileSearchContainer.querySelector('#google-search');

    if (mobileSphinxSearch && mobileGoogleSearch) {
      mobileSphinxSearch.style.display = toggle.checked ? 'none' : 'block';
      mobileGoogleSearch.style.display = toggle.checked ? 'block' : 'none';

      if (toggle.checked) {
        reinitializeGoogleSearch();
      }
    }
  }

  // Initialize desktop search toggle
  const toggle = document.getElementById('search-toggle');
  const sphinxSearch = document.getElementById('sphinx-search');
  const googleSearch = document.getElementById('google-search');
  handleSearchToggle(toggle, sphinxSearch, googleSearch);

  // Set placeholder text for Google search input
  const observer = new MutationObserver(function() {
    document.querySelectorAll('.gsc-input input').forEach(input => {
      if (input && !input.hasAttribute('data-placeholder-set')) {
        input.setAttribute('placeholder', 'Search the docs ...');
        input.setAttribute('data-placeholder-set', 'true');
      }
    });
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // Fix for scroll jump issue - improved approach
  function setupSearchInputHandlers(input) {
    if (input.hasAttribute('data-scroll-fixed')) return;
    input.setAttribute('data-scroll-fixed', 'true');

    let lastScrollPosition = 0;
    let isTyping = false;
    let scrollTimeout;

    // Save position before typing starts
    input.addEventListener('keydown', () => {
      lastScrollPosition = window.scrollY;
      isTyping = true;

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);
    });

    // Only maintain scroll position during typing
    function maintainScroll() {
      if (document.activeElement === input && isTyping) {
        window.scrollTo(0, lastScrollPosition);
        requestAnimationFrame(maintainScroll);
      }
    }

    input.addEventListener('focus', () => {
      // Just store initial position but don't force it
      lastScrollPosition = window.scrollY;
    });

    input.addEventListener('input', () => {
      isTyping = true;
      window.scrollTo(0, lastScrollPosition);

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);

      requestAnimationFrame(maintainScroll);
    });
  }

  // Apply to all search inputs and observe for new ones
  function applyToSearchInputs() {
    document.querySelectorAll('.search-container input, .gsc-input input').forEach(setupSearchInputHandlers);
  }

  applyToSearchInputs();

  const searchObserver = new MutationObserver(applyToSearchInputs);
  searchObserver.observe(document.body, { childList: true, subtree: true });

  // Watch for mobile menu creation
  const mobileMenuObserver = new MutationObserver(function(mutations) {
    for (const mutation of mutations) {
      if (!mutation.addedNodes.length) continue;

      // Style mobile search inputs
      document.querySelectorAll('.sidebar-header-items__end .navbar-item .search-container-wrapper .gsc-input input').forEach(input => {
        if (input) {
          input.setAttribute('placeholder', 'Search the docs ...');
          input.style.paddingLeft = '36px';
        }
      });

      // Check for mobile search container
      const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
      if (!mobileSearchContainer) continue;

      const mobileToggle = mobileSearchContainer.querySelector('#search-toggle');
      if (mobileToggle && toggle) {
        // Sync mobile toggle with desktop toggle
        mobileToggle.checked = toggle.checked;
        updateMobileSearch();

        // Add event listener to mobile toggle if not already added
        if (!mobileToggle.hasAttribute('data-initialized')) {
          mobileToggle.setAttribute('data-initialized', 'true');
          mobileToggle.addEventListener('change', function() {
            // Sync desktop toggle with mobile toggle
            toggle.checked = this.checked;
            // Trigger change event on desktop toggle to update both
            toggle.dispatchEvent(new Event('change'));
          });
        }
      }
    }
  });

  mobileMenuObserver.observe(document.body, { childList: true, subtree: true });

  // Ensure Google CSE is properly loaded
  if (window.__gcse) {
    window.__gcse.callback = function() {
      // This will run after Google CSE is fully loaded
      if (toggle && toggle.checked) {
        reinitializeGoogleSearch();
      }
    };
  } else {
    window.__gcse = {
      callback: function() {
        if (toggle && toggle.checked) {
          reinitializeGoogleSearch();
        }
      }
    };
  }
});
</script>
</div>
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PyTorchKorea/tutorials-kr" title="한국어 튜토리얼 GitHub 저장소" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">한국어 튜토리얼 GitHub 저장소</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discuss.pytorch.kr/" title="파이토치 한국어 커뮤니티" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">파이토치 한국어 커뮤니티</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">옵티마이저 단계를...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">
<div class="rating">
    Rate this Page
    <div class="stars">
        
        <span class="star" data-behavior="tutorial-rating" data-count="1" data-value="1">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="2" data-value="2">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="3" data-value="3">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="4" data-value="4">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="5" data-value="5">★</span>
        
    </div>
</div>
</div>
      
    </div>
  
</div>
</div>
              
              
  
<div id="searchbox"></div>
  <article class="bd-article" id="pytorch-article">
    <!-- Hidden breadcrumb schema for SEO only -->
    <div style="display:none;" itemscope itemtype="https://schema.org/BreadcrumbList">
      
      <div itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <meta itemprop="name" content="옵티마이저 단계를 backward pass에 합쳐서 메모리 절약하기">
        <meta itemprop="position" content="1">
      </div>
    </div>

    
    <script>
      if ((window.location.href.indexOf("/unstable/") != -1) && (window.location.href.indexOf("/unstable/unstable_index") < 1)) {
        var div = '<div class="prototype-banner"><i class="fa fa-flask" aria-hidden="true"></i> <strong>Unstable feature:</strong> Not typically available in binary distributions like PyPI. Early stage for feedback and testing.</div>'
        document.addEventListener('DOMContentLoaded', function () {
          document.getElementById("pytorch-article").insertAdjacentHTML('afterBegin', div);
        });
      }
    </script>
    
    
    <div class="pytorch-call-to-action-links">
      <div id="tutorial-type">intermediate/optimizer_step_in_backward_tutorial</div>
      <a id="colab-link" data-behavior="call-to-action-event" data-response="Run in Google Colab" target="_blank">
        <div id="google-colab-link">
          <img class="call-to-action-img" src="../_static/img/pytorch-colab.svg" />
          <div class="call-to-action-desktop-view">Run in Google Colab</div>
          <div class="call-to-action-mobile-view">Colab</div>
        </div>
      </a>
      <a id="notebook-link" data-behavior="call-to-action-event" data-response="Download Notebook">
        <div id="download-notebook-link">
          <img class="call-to-action-notebook-img" src="../_static/img/pytorch-download.svg" />
          <div class="call-to-action-desktop-view">Download Notebook</div>
          <div class="call-to-action-mobile-view">Notebook</div>
        </div>
      </a>
      <a id="github-link" data-behavior="call-to-action-event" data-response="View on Github" target="_blank">
        <div id="github-view-link">
          <img class="call-to-action-img" src="../_static/img/pytorch-github.svg" />
          <div class="call-to-action-desktop-view">View on GitHub</div>
          <div class="call-to-action-mobile-view">GitHub</div>
        </div>
      </a>
    </div>
    

    
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">참고</p>
<p><a class="reference internal" href="#sphx-glr-download-intermediate-optimizer-step-in-backward-tutorial-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="backward-pass">
<span id="sphx-glr-intermediate-optimizer-step-in-backward-tutorial-py"></span><h1>옵티마이저 단계를 backward pass에 합쳐서 메모리 절약하기<a class="headerlink" href="#backward-pass" title="Link to this heading">#</a></h1>
<p><strong>번역</strong>: <a class="reference external" href="https://github.com/hadh93">하동훈</a></p>
<p>안녕하세요! 이 튜토리얼에서는 <em>변화도(gradient)</em> 가 차지하는 메모리를
줄임으로써 학습 루프(training loop)에서의 메모리 사용량을 줄이는 한 가지
방법을 소개합니다. 모델이 있는 상황에서 메모리 최적화를 통해 메모리
부족(Out of Memory, OOM) 오류를 방지하고 싶거나, GPU의 성능을 최대한
활용하고 싶은 경우 이 방법이 도움이 될 수 있습니다 (변화도가 메모리의
일부분을 차지하고 있으며, 변화도 누적(accumulation)이 필요하지
않은 경우라면 말입니다). 이 튜토리얼은 다음 내용을 다룹니다:</p>
<ol class="arabic simple">
<li><p>학습 또는 미세 조정(finetuning) 루프에서 메모리를 차지하는 요소,</p></li>
<li><p>병목 현상을 파악하기 위해 메모리 스냅샷(snapshot)을 캡처하고 시각화하는 방법,</p></li>
<li><p>새로운 <code class="docutils literal notranslate"><span class="pre">Tensor.register_post_accumulate_grad_hook(hook)</span></code> API,</p></li>
<li><p>이 모든 것을 감안한 단 10줄의 코드로 메모리를 절약하는 방법.</p></li>
</ol>
<p>이 튜토리얼을 실행하기 위해 필요한 것:</p>
<ul class="simple">
<li><p>2.1.0 혹은 그 이상의 버전의 PyTorch와 <code class="docutils literal notranslate"><span class="pre">torchvision</span></code></p></li>
<li><p>메모리 시각화를 로컬에서 실행하려면, CUDA GPU 1개.
메모리 시각화를 제외하면 이 최적화 방법은 모든 장치에서 유사한 이점을 제공합니다.</p></li>
</ul>
<p>먼저 필요한 모듈과 모델을 import 하겠습니다. 여기에서는 torchvision의 비전
트랜스포머 모델을 사용하지만, 다른 모델로 대체해도 좋습니다. 또 옵티마이저로
<code class="docutils literal notranslate"><span class="pre">torch.optim.Adam</span></code> 을 사용하지만, 마찬가지로 다른 옵티마이저로 대체해도
됩니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pickle</span><span class="w"> </span><span class="kn">import</span> <span class="n">dump</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">vit_l_16</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Downloading: &quot;https://download.pytorch.org/models/vit_l_16-852ce7e3.pth&quot; to /root/.cache/torch/hub/checkpoints/vit_l_16-852ce7e3.pth

  0%|          | 0.00/1.13G [00:00&lt;?, ?B/s]
  0%|          | 128k/1.13G [00:00&lt;1:23:49, 242kB/s]
  0%|          | 384k/1.13G [00:00&lt;32:10, 630kB/s]
  0%|          | 640k/1.13G [00:00&lt;22:48, 889kB/s]
  0%|          | 1.12M/1.13G [00:01&lt;13:23, 1.51MB/s]
  0%|          | 2.25M/1.13G [00:01&lt;06:37, 3.05MB/s]
  0%|          | 4.50M/1.13G [00:01&lt;03:18, 6.10MB/s]
  1%|          | 8.38M/1.13G [00:01&lt;01:49, 11.0MB/s]
  1%|          | 12.1M/1.13G [00:01&lt;01:24, 14.2MB/s]
  1%|▏         | 16.0M/1.13G [00:01&lt;01:12, 16.6MB/s]
  2%|▏         | 19.9M/1.13G [00:02&lt;01:05, 18.3MB/s]
  2%|▏         | 23.8M/1.13G [00:02&lt;01:01, 19.3MB/s]
  2%|▏         | 27.6M/1.13G [00:02&lt;00:58, 20.2MB/s]
  3%|▎         | 31.5M/1.13G [00:02&lt;00:57, 20.8MB/s]
  3%|▎         | 35.4M/1.13G [00:02&lt;00:55, 21.2MB/s]
  3%|▎         | 39.2M/1.13G [00:03&lt;00:55, 21.4MB/s]
  4%|▎         | 43.0M/1.13G [00:03&lt;00:54, 21.4MB/s]
  4%|▍         | 46.9M/1.13G [00:03&lt;00:54, 21.6MB/s]
  4%|▍         | 50.6M/1.13G [00:03&lt;00:53, 21.6MB/s]
  5%|▍         | 54.5M/1.13G [00:03&lt;00:53, 21.7MB/s]
  5%|▌         | 58.4M/1.13G [00:04&lt;00:52, 21.9MB/s]
  5%|▌         | 62.1M/1.13G [00:04&lt;00:53, 21.7MB/s]
  6%|▌         | 66.0M/1.13G [00:04&lt;00:52, 21.8MB/s]
  6%|▌         | 69.9M/1.13G [00:04&lt;00:52, 21.9MB/s]
  6%|▋         | 73.8M/1.13G [00:04&lt;00:52, 21.9MB/s]
  7%|▋         | 77.6M/1.13G [00:04&lt;00:51, 22.0MB/s]
  7%|▋         | 81.5M/1.13G [00:05&lt;00:51, 21.9MB/s]
  7%|▋         | 85.4M/1.13G [00:05&lt;00:51, 22.0MB/s]
  8%|▊         | 89.1M/1.13G [00:05&lt;00:51, 21.8MB/s]
  8%|▊         | 93.0M/1.13G [00:05&lt;00:51, 21.9MB/s]
  8%|▊         | 96.9M/1.13G [00:05&lt;00:50, 22.0MB/s]
  9%|▊         | 101M/1.13G [00:06&lt;00:50, 21.8MB/s]
  9%|▉         | 104M/1.13G [00:06&lt;00:50, 21.9MB/s]
  9%|▉         | 108M/1.13G [00:06&lt;00:50, 21.9MB/s]
 10%|▉         | 112M/1.13G [00:06&lt;00:49, 22.0MB/s]
 10%|▉         | 116M/1.13G [00:06&lt;00:50, 21.7MB/s]
 10%|█         | 120M/1.13G [00:06&lt;00:49, 21.9MB/s]
 11%|█         | 124M/1.13G [00:07&lt;00:49, 22.0MB/s]
 11%|█         | 128M/1.13G [00:07&lt;00:49, 22.0MB/s]
 11%|█▏        | 132M/1.13G [00:07&lt;00:48, 22.1MB/s]
 12%|█▏        | 135M/1.13G [00:07&lt;00:48, 22.1MB/s]
 12%|█▏        | 139M/1.13G [00:07&lt;00:48, 21.9MB/s]
 12%|█▏        | 143M/1.13G [00:08&lt;00:48, 21.9MB/s]
 13%|█▎        | 147M/1.13G [00:08&lt;00:48, 21.8MB/s]
 13%|█▎        | 151M/1.13G [00:08&lt;00:48, 21.9MB/s]
 13%|█▎        | 154M/1.13G [00:08&lt;00:48, 21.9MB/s]
 14%|█▎        | 158M/1.13G [00:08&lt;00:49, 21.2MB/s]
 14%|█▍        | 162M/1.13G [00:08&lt;00:49, 21.3MB/s]
 14%|█▍        | 166M/1.13G [00:09&lt;00:48, 21.5MB/s]
 15%|█▍        | 169M/1.13G [00:09&lt;00:47, 21.7MB/s]
 15%|█▍        | 173M/1.13G [00:09&lt;00:47, 21.6MB/s]
 15%|█▌        | 177M/1.13G [00:09&lt;00:47, 21.7MB/s]
 16%|█▌        | 181M/1.13G [00:09&lt;00:47, 21.9MB/s]
 16%|█▌        | 185M/1.13G [00:10&lt;00:46, 21.9MB/s]
 16%|█▌        | 188M/1.13G [00:10&lt;00:46, 21.8MB/s]
 17%|█▋        | 192M/1.13G [00:10&lt;00:46, 21.9MB/s]
 17%|█▋        | 196M/1.13G [00:10&lt;00:46, 21.7MB/s]
 17%|█▋        | 200M/1.13G [00:10&lt;00:45, 22.0MB/s]
 18%|█▊        | 204M/1.13G [00:11&lt;00:46, 21.8MB/s]
 18%|█▊        | 208M/1.13G [00:11&lt;00:45, 21.9MB/s]
 18%|█▊        | 212M/1.13G [00:11&lt;00:45, 22.0MB/s]
 19%|█▊        | 216M/1.13G [00:11&lt;00:45, 21.9MB/s]
 19%|█▉        | 219M/1.13G [00:11&lt;00:44, 22.1MB/s]
 19%|█▉        | 223M/1.13G [00:11&lt;00:44, 22.1MB/s]
 20%|█▉        | 227M/1.13G [00:12&lt;00:44, 22.1MB/s]
 20%|█▉        | 231M/1.13G [00:12&lt;00:44, 21.9MB/s]
 20%|██        | 235M/1.13G [00:12&lt;00:44, 21.9MB/s]
 21%|██        | 239M/1.13G [00:12&lt;00:44, 21.9MB/s]
 21%|██        | 242M/1.13G [00:12&lt;00:43, 22.0MB/s]
 21%|██        | 246M/1.13G [00:13&lt;00:43, 22.0MB/s]
 22%|██▏       | 250M/1.13G [00:13&lt;00:43, 21.8MB/s]
 22%|██▏       | 254M/1.13G [00:13&lt;00:43, 21.9MB/s]
 22%|██▏       | 258M/1.13G [00:13&lt;00:43, 21.9MB/s]
 23%|██▎       | 262M/1.13G [00:13&lt;00:42, 22.0MB/s]
 23%|██▎       | 266M/1.13G [00:13&lt;00:42, 22.0MB/s]
 23%|██▎       | 269M/1.13G [00:14&lt;00:42, 21.9MB/s]
 24%|██▎       | 273M/1.13G [00:14&lt;00:42, 21.9MB/s]
 24%|██▍       | 277M/1.13G [00:14&lt;00:42, 21.9MB/s]
 24%|██▍       | 281M/1.13G [00:14&lt;00:42, 21.8MB/s]
 25%|██▍       | 285M/1.13G [00:14&lt;00:42, 21.9MB/s]
 25%|██▍       | 289M/1.13G [00:15&lt;00:41, 22.0MB/s]
 25%|██▌       | 292M/1.13G [00:15&lt;00:41, 22.0MB/s]
 26%|██▌       | 296M/1.13G [00:15&lt;00:41, 22.1MB/s]
 26%|██▌       | 300M/1.13G [00:15&lt;00:40, 22.1MB/s]
 26%|██▌       | 304M/1.13G [00:15&lt;00:41, 21.9MB/s]
 27%|██▋       | 308M/1.13G [00:15&lt;00:40, 22.0MB/s]
 27%|██▋       | 312M/1.13G [00:16&lt;00:40, 22.0MB/s]
 27%|██▋       | 316M/1.13G [00:16&lt;00:40, 22.0MB/s]
 28%|██▊       | 319M/1.13G [00:16&lt;00:40, 21.9MB/s]
 28%|██▊       | 323M/1.13G [00:16&lt;00:40, 21.9MB/s]
 28%|██▊       | 327M/1.13G [00:16&lt;00:39, 22.0MB/s]
 29%|██▊       | 331M/1.13G [00:17&lt;00:39, 22.0MB/s]
 29%|██▉       | 335M/1.13G [00:17&lt;00:39, 21.8MB/s]
 29%|██▉       | 339M/1.13G [00:17&lt;00:39, 21.9MB/s]
 29%|██▉       | 342M/1.13G [00:17&lt;00:39, 22.0MB/s]
 30%|██▉       | 346M/1.13G [00:17&lt;00:38, 22.0MB/s]
 30%|███       | 350M/1.13G [00:17&lt;00:38, 22.0MB/s]
 31%|███       | 354M/1.13G [00:18&lt;00:38, 22.1MB/s]
 31%|███       | 358M/1.13G [00:18&lt;00:38, 22.1MB/s]
 31%|███       | 362M/1.13G [00:18&lt;00:37, 22.1MB/s]
 31%|███▏      | 366M/1.13G [00:18&lt;00:38, 21.9MB/s]
 32%|███▏      | 370M/1.13G [00:18&lt;00:37, 22.0MB/s]
 32%|███▏      | 373M/1.13G [00:19&lt;00:37, 22.0MB/s]
 32%|███▏      | 377M/1.13G [00:19&lt;00:37, 22.0MB/s]
 33%|███▎      | 381M/1.13G [00:19&lt;00:37, 22.1MB/s]
 33%|███▎      | 385M/1.13G [00:19&lt;00:36, 22.1MB/s]
 33%|███▎      | 389M/1.13G [00:19&lt;00:36, 21.9MB/s]
 34%|███▍      | 393M/1.13G [00:20&lt;00:36, 22.0MB/s]
 34%|███▍      | 396M/1.13G [00:20&lt;00:36, 22.0MB/s]
 34%|███▍      | 400M/1.13G [00:20&lt;00:36, 22.0MB/s]
 35%|███▍      | 404M/1.13G [00:20&lt;00:36, 21.9MB/s]
 35%|███▌      | 408M/1.13G [00:20&lt;00:35, 22.1MB/s]
 35%|███▌      | 412M/1.13G [00:20&lt;00:35, 21.9MB/s]
 36%|███▌      | 416M/1.13G [00:21&lt;00:35, 22.0MB/s]
 36%|███▌      | 420M/1.13G [00:21&lt;00:35, 22.0MB/s]
 36%|███▋      | 423M/1.13G [00:21&lt;00:35, 21.8MB/s]
 37%|███▋      | 427M/1.13G [00:21&lt;00:35, 21.9MB/s]
 37%|███▋      | 431M/1.13G [00:21&lt;00:34, 22.0MB/s]
 37%|███▋      | 435M/1.13G [00:22&lt;00:34, 22.0MB/s]
 38%|███▊      | 439M/1.13G [00:22&lt;00:34, 22.0MB/s]
 38%|███▊      | 443M/1.13G [00:22&lt;00:34, 22.0MB/s]
 38%|███▊      | 447M/1.13G [00:22&lt;00:34, 21.9MB/s]
 39%|███▉      | 450M/1.13G [00:22&lt;00:34, 21.8MB/s]
 39%|███▉      | 454M/1.13G [00:22&lt;00:33, 21.9MB/s]
 39%|███▉      | 458M/1.13G [00:23&lt;00:33, 21.9MB/s]
 40%|███▉      | 462M/1.13G [00:23&lt;00:34, 21.6MB/s]
 40%|████      | 466M/1.13G [00:23&lt;00:33, 21.6MB/s]
 40%|████      | 469M/1.13G [00:23&lt;00:36, 20.1MB/s]
 41%|████      | 472M/1.13G [00:23&lt;00:34, 20.7MB/s]
 41%|████      | 476M/1.13G [00:24&lt;00:34, 21.1MB/s]
 41%|████▏     | 480M/1.13G [00:24&lt;00:33, 21.4MB/s]
 42%|████▏     | 484M/1.13G [00:24&lt;00:33, 21.4MB/s]
 42%|████▏     | 488M/1.13G [00:24&lt;00:32, 21.4MB/s]
 42%|████▏     | 492M/1.13G [00:24&lt;00:32, 21.6MB/s]
 43%|████▎     | 496M/1.13G [00:24&lt;00:32, 21.8MB/s]
 43%|████▎     | 499M/1.13G [00:25&lt;00:31, 21.8MB/s]
 43%|████▎     | 503M/1.13G [00:25&lt;00:32, 21.5MB/s]
 44%|████▎     | 507M/1.13G [00:25&lt;00:31, 21.6MB/s]
 44%|████▍     | 511M/1.13G [00:25&lt;00:31, 21.8MB/s]
 44%|████▍     | 515M/1.13G [00:25&lt;00:30, 21.9MB/s]
 45%|████▍     | 519M/1.13G [00:26&lt;00:30, 22.0MB/s]
 45%|████▌     | 522M/1.13G [00:26&lt;00:30, 22.0MB/s]
 45%|████▌     | 526M/1.13G [00:26&lt;00:30, 22.0MB/s]
 46%|████▌     | 530M/1.13G [00:26&lt;00:30, 22.0MB/s]
 46%|████▌     | 534M/1.13G [00:26&lt;00:29, 22.0MB/s]
 46%|████▋     | 538M/1.13G [00:27&lt;00:29, 22.0MB/s]
 47%|████▋     | 542M/1.13G [00:27&lt;00:29, 22.1MB/s]
 47%|████▋     | 546M/1.13G [00:27&lt;00:29, 22.1MB/s]
 47%|████▋     | 550M/1.13G [00:27&lt;00:29, 22.1MB/s]
 48%|████▊     | 554M/1.13G [00:27&lt;00:28, 22.1MB/s]
 48%|████▊     | 557M/1.13G [00:27&lt;00:28, 21.9MB/s]
 48%|████▊     | 561M/1.13G [00:28&lt;00:28, 21.9MB/s]
 49%|████▊     | 565M/1.13G [00:28&lt;00:28, 22.0MB/s]
 49%|████▉     | 569M/1.13G [00:28&lt;00:28, 22.0MB/s]
 49%|████▉     | 573M/1.13G [00:28&lt;00:27, 22.0MB/s]
 50%|████▉     | 577M/1.13G [00:28&lt;00:27, 22.1MB/s]
 50%|████▉     | 580M/1.13G [00:29&lt;00:27, 22.1MB/s]
 50%|█████     | 584M/1.13G [00:29&lt;00:27, 22.1MB/s]
 51%|█████     | 588M/1.13G [00:29&lt;00:27, 22.1MB/s]
 51%|█████     | 592M/1.13G [00:29&lt;00:26, 22.1MB/s]
 51%|█████▏    | 596M/1.13G [00:29&lt;00:26, 22.1MB/s]
 52%|█████▏    | 600M/1.13G [00:29&lt;00:26, 21.9MB/s]
 52%|█████▏    | 604M/1.13G [00:30&lt;00:26, 21.9MB/s]
 52%|█████▏    | 608M/1.13G [00:30&lt;00:26, 22.0MB/s]
 53%|█████▎    | 611M/1.13G [00:30&lt;00:26, 22.0MB/s]
 53%|█████▎    | 615M/1.13G [00:30&lt;00:25, 22.0MB/s]
 53%|█████▎    | 619M/1.13G [00:30&lt;00:25, 22.0MB/s]
 54%|█████▎    | 623M/1.13G [00:31&lt;00:25, 22.1MB/s]
 54%|█████▍    | 627M/1.13G [00:31&lt;00:25, 22.1MB/s]
 54%|█████▍    | 631M/1.13G [00:31&lt;00:25, 21.8MB/s]
 55%|█████▍    | 634M/1.13G [00:31&lt;00:25, 21.9MB/s]
 55%|█████▍    | 638M/1.13G [00:31&lt;00:24, 22.0MB/s]
 55%|█████▌    | 642M/1.13G [00:31&lt;00:24, 22.0MB/s]
 56%|█████▌    | 644M/1.13G [00:34&lt;02:06, 4.28MB/s]
 56%|█████▌    | 646M/1.13G [00:34&lt;01:52, 4.81MB/s]
 56%|█████▌    | 649M/1.13G [00:34&lt;01:25, 6.28MB/s]
 56%|█████▋    | 653M/1.13G [00:34&lt;01:03, 8.45MB/s]
 57%|█████▋    | 657M/1.13G [00:35&lt;00:49, 10.7MB/s]
 57%|█████▋    | 661M/1.13G [00:35&lt;00:41, 12.6MB/s]
 57%|█████▋    | 665M/1.13G [00:35&lt;00:34, 15.0MB/s]
 58%|█████▊    | 669M/1.13G [00:35&lt;00:31, 16.6MB/s]
 58%|█████▊    | 672M/1.13G [00:35&lt;00:28, 18.0MB/s]
 58%|█████▊    | 676M/1.13G [00:35&lt;00:26, 19.1MB/s]
 59%|█████▊    | 680M/1.13G [00:36&lt;00:25, 19.9MB/s]
 59%|█████▉    | 684M/1.13G [00:36&lt;00:24, 20.5MB/s]
 59%|█████▉    | 688M/1.13G [00:36&lt;00:23, 21.0MB/s]
 60%|█████▉    | 692M/1.13G [00:36&lt;00:23, 21.3MB/s]
 60%|█████▉    | 696M/1.13G [00:36&lt;00:22, 21.8MB/s]
 60%|██████    | 700M/1.13G [00:37&lt;00:22, 21.7MB/s]
 61%|██████    | 704M/1.13G [00:37&lt;00:22, 21.8MB/s]
 61%|██████    | 707M/1.13G [00:37&lt;00:21, 21.9MB/s]
 61%|██████▏   | 711M/1.13G [00:37&lt;00:21, 22.1MB/s]
 62%|██████▏   | 715M/1.13G [00:37&lt;00:20, 22.3MB/s]
 62%|██████▏   | 719M/1.13G [00:37&lt;00:20, 22.2MB/s]
 62%|██████▏   | 722M/1.13G [00:38&lt;00:21, 21.1MB/s]
 63%|██████▎   | 726M/1.13G [00:38&lt;00:21, 21.2MB/s]
 63%|██████▎   | 730M/1.13G [00:38&lt;00:21, 21.5MB/s]
 63%|██████▎   | 734M/1.13G [00:38&lt;00:20, 21.9MB/s]
 64%|██████▎   | 738M/1.13G [00:38&lt;00:20, 21.6MB/s]
 64%|██████▍   | 742M/1.13G [00:39&lt;00:20, 21.7MB/s]
 64%|██████▍   | 746M/1.13G [00:39&lt;00:19, 21.9MB/s]
 65%|██████▍   | 750M/1.13G [00:39&lt;00:19, 21.9MB/s]
 65%|██████▍   | 754M/1.13G [00:39&lt;00:19, 22.4MB/s]
 65%|██████▌   | 758M/1.13G [00:39&lt;00:19, 22.2MB/s]
 65%|██████▌   | 760M/1.13G [00:39&lt;00:20, 21.0MB/s]
 66%|██████▌   | 762M/1.13G [00:40&lt;00:20, 20.6MB/s]
 66%|██████▌   | 765M/1.13G [00:40&lt;00:17, 23.3MB/s]
 66%|██████▋   | 769M/1.13G [00:40&lt;00:17, 23.1MB/s]
 67%|██████▋   | 773M/1.13G [00:40&lt;00:17, 22.7MB/s]
 67%|██████▋   | 777M/1.13G [00:40&lt;00:17, 22.5MB/s]
 67%|██████▋   | 781M/1.13G [00:40&lt;00:17, 22.4MB/s]
 68%|██████▊   | 785M/1.13G [00:41&lt;00:17, 22.3MB/s]
 68%|██████▊   | 789M/1.13G [00:41&lt;00:17, 22.0MB/s]
 68%|██████▊   | 792M/1.13G [00:41&lt;00:17, 22.0MB/s]
 69%|██████▊   | 796M/1.13G [00:41&lt;00:17, 21.8MB/s]
 69%|██████▉   | 800M/1.13G [00:41&lt;00:17, 21.9MB/s]
 69%|██████▉   | 804M/1.13G [00:42&lt;00:16, 22.2MB/s]
 70%|██████▉   | 808M/1.13G [00:42&lt;00:16, 22.2MB/s]
 70%|██████▉   | 812M/1.13G [00:42&lt;00:16, 22.6MB/s]
 70%|███████   | 816M/1.13G [00:42&lt;00:16, 22.4MB/s]
 71%|███████   | 820M/1.13G [00:42&lt;00:15, 22.5MB/s]
 71%|███████   | 824M/1.13G [00:42&lt;00:15, 22.4MB/s]
 71%|███████▏  | 828M/1.13G [00:43&lt;00:15, 22.5MB/s]
 72%|███████▏  | 832M/1.13G [00:43&lt;00:15, 22.2MB/s]
 72%|███████▏  | 836M/1.13G [00:43&lt;00:15, 22.3MB/s]
 72%|███████▏  | 840M/1.13G [00:43&lt;00:15, 22.2MB/s]
 73%|███████▎  | 843M/1.13G [00:43&lt;00:14, 22.2MB/s]
 73%|███████▎  | 847M/1.13G [00:44&lt;00:14, 22.2MB/s]
 73%|███████▎  | 851M/1.13G [00:44&lt;00:14, 22.1MB/s]
 74%|███████▎  | 855M/1.13G [00:44&lt;00:14, 22.0MB/s]
 74%|███████▍  | 859M/1.13G [00:44&lt;00:14, 22.1MB/s]
 74%|███████▍  | 863M/1.13G [00:44&lt;00:14, 22.3MB/s]
 75%|███████▍  | 867M/1.13G [00:44&lt;00:13, 22.3MB/s]
 75%|███████▍  | 871M/1.13G [00:45&lt;00:13, 22.2MB/s]
 75%|███████▌  | 874M/1.13G [00:45&lt;00:13, 22.2MB/s]
 76%|███████▌  | 878M/1.13G [00:45&lt;00:13, 21.8MB/s]
 76%|███████▌  | 882M/1.13G [00:45&lt;00:13, 22.0MB/s]
 76%|███████▋  | 886M/1.13G [00:45&lt;00:13, 21.8MB/s]
 77%|███████▋  | 889M/1.13G [00:46&lt;00:14, 20.3MB/s]
 77%|███████▋  | 893M/1.13G [00:46&lt;00:12, 21.7MB/s]
 77%|███████▋  | 897M/1.13G [00:46&lt;00:12, 21.6MB/s]
 78%|███████▊  | 901M/1.13G [00:46&lt;00:12, 21.9MB/s]
 78%|███████▊  | 905M/1.13G [00:46&lt;00:12, 21.8MB/s]
 78%|███████▊  | 909M/1.13G [00:46&lt;00:11, 22.3MB/s]
 79%|███████▊  | 913M/1.13G [00:47&lt;00:11, 22.2MB/s]
 79%|███████▉  | 917M/1.13G [00:47&lt;00:11, 22.4MB/s]
 79%|███████▉  | 920M/1.13G [00:47&lt;00:11, 22.1MB/s]
 80%|███████▉  | 924M/1.13G [00:47&lt;00:11, 22.1MB/s]
 80%|███████▉  | 928M/1.13G [00:47&lt;00:11, 22.1MB/s]
 80%|████████  | 932M/1.13G [00:48&lt;00:10, 22.1MB/s]
 81%|████████  | 936M/1.13G [00:48&lt;00:10, 22.1MB/s]
 81%|████████  | 940M/1.13G [00:48&lt;00:10, 22.1MB/s]
 81%|████████▏ | 944M/1.13G [00:48&lt;00:10, 22.1MB/s]
 82%|████████▏ | 948M/1.13G [00:48&lt;00:10, 22.1MB/s]
 82%|████████▏ | 952M/1.13G [00:49&lt;00:09, 22.9MB/s]
 82%|████████▏ | 956M/1.13G [00:49&lt;00:09, 23.1MB/s]
 83%|████████▎ | 960M/1.13G [00:49&lt;00:09, 22.6MB/s]
 83%|████████▎ | 964M/1.13G [00:49&lt;00:09, 22.5MB/s]
 83%|████████▎ | 968M/1.13G [00:49&lt;00:09, 22.3MB/s]
 84%|████████▎ | 971M/1.13G [00:49&lt;00:08, 22.3MB/s]
 84%|████████▍ | 975M/1.13G [00:50&lt;00:08, 22.1MB/s]
 84%|████████▍ | 979M/1.13G [00:50&lt;00:08, 22.3MB/s]
 85%|████████▍ | 983M/1.13G [00:50&lt;00:08, 22.0MB/s]
 85%|████████▍ | 987M/1.13G [00:50&lt;00:08, 22.0MB/s]
 85%|████████▌ | 991M/1.13G [00:50&lt;00:08, 22.0MB/s]
 86%|████████▌ | 995M/1.13G [00:51&lt;00:07, 22.3MB/s]
 86%|████████▌ | 998M/1.13G [00:51&lt;00:07, 22.2MB/s]
 86%|████████▋ | 0.98G/1.13G [00:51&lt;00:07, 21.1MB/s]
 87%|████████▋ | 0.98G/1.13G [00:51&lt;00:07, 21.4MB/s]
 87%|████████▋ | 0.99G/1.13G [00:51&lt;00:07, 20.8MB/s]
 87%|████████▋ | 0.99G/1.13G [00:51&lt;00:07, 21.2MB/s]
 88%|████████▊ | 0.99G/1.13G [00:52&lt;00:06, 22.5MB/s]
 88%|████████▊ | 1.00G/1.13G [00:52&lt;00:06, 22.3MB/s]
 88%|████████▊ | 1.00G/1.13G [00:52&lt;00:06, 22.4MB/s]
 89%|████████▊ | 1.01G/1.13G [00:52&lt;00:06, 22.4MB/s]
 89%|████████▉ | 1.01G/1.13G [00:52&lt;00:06, 22.3MB/s]
 89%|████████▉ | 1.01G/1.13G [00:53&lt;00:05, 22.0MB/s]
 90%|████████▉ | 1.02G/1.13G [00:53&lt;00:05, 22.0MB/s]
 90%|████████▉ | 1.02G/1.13G [00:53&lt;00:05, 22.2MB/s]
 90%|█████████ | 1.02G/1.13G [00:53&lt;00:05, 22.5MB/s]
 91%|█████████ | 1.03G/1.13G [00:53&lt;00:05, 22.5MB/s]
 91%|█████████ | 1.03G/1.13G [00:53&lt;00:04, 22.6MB/s]
 91%|█████████▏| 1.04G/1.13G [00:54&lt;00:04, 22.7MB/s]
 92%|█████████▏| 1.04G/1.13G [00:54&lt;00:04, 22.8MB/s]
 92%|█████████▏| 1.04G/1.13G [00:54&lt;00:04, 22.4MB/s]
 92%|█████████▏| 1.05G/1.13G [00:54&lt;00:04, 22.3MB/s]
 93%|█████████▎| 1.05G/1.13G [00:54&lt;00:03, 22.3MB/s]
 93%|█████████▎| 1.06G/1.13G [00:55&lt;00:03, 22.6MB/s]
 93%|█████████▎| 1.06G/1.13G [00:55&lt;00:03, 22.6MB/s]
 94%|█████████▎| 1.06G/1.13G [00:55&lt;00:03, 22.7MB/s]
 94%|█████████▍| 1.07G/1.13G [00:55&lt;00:03, 22.3MB/s]
 94%|█████████▍| 1.07G/1.13G [00:55&lt;00:03, 22.0MB/s]
 95%|█████████▍| 1.07G/1.13G [00:55&lt;00:02, 22.1MB/s]
 95%|█████████▌| 1.08G/1.13G [00:56&lt;00:02, 22.0MB/s]
 95%|█████████▌| 1.08G/1.13G [00:56&lt;00:02, 22.1MB/s]
 96%|█████████▌| 1.09G/1.13G [00:56&lt;00:02, 22.1MB/s]
 96%|█████████▌| 1.09G/1.13G [00:56&lt;00:02, 22.1MB/s]
 96%|█████████▋| 1.09G/1.13G [00:56&lt;00:02, 20.0MB/s]
 97%|█████████▋| 1.10G/1.13G [00:57&lt;00:02, 20.4MB/s]
 97%|█████████▋| 1.10G/1.13G [00:57&lt;00:01, 21.1MB/s]
 97%|█████████▋| 1.10G/1.13G [00:57&lt;00:01, 21.4MB/s]
 98%|█████████▊| 1.11G/1.13G [00:57&lt;00:01, 21.4MB/s]
 98%|█████████▊| 1.11G/1.13G [00:58&lt;00:02, 12.7MB/s]
 98%|█████████▊| 1.11G/1.13G [00:58&lt;00:01, 13.8MB/s]
 98%|█████████▊| 1.12G/1.13G [00:58&lt;00:01, 15.7MB/s]
 99%|█████████▊| 1.12G/1.13G [00:58&lt;00:00, 17.3MB/s]
 99%|█████████▉| 1.12G/1.13G [00:58&lt;00:00, 18.5MB/s]
 99%|█████████▉| 1.13G/1.13G [00:59&lt;00:00, 19.2MB/s]
100%|█████████▉| 1.13G/1.13G [00:59&lt;00:00, 20.0MB/s]
100%|█████████▉| 1.13G/1.13G [00:59&lt;00:00, 20.4MB/s]
100%|██████████| 1.13G/1.13G [00:59&lt;00:00, 20.5MB/s]
</pre></div>
</div>
<p>이제 일반적인 학습 루프를 정의해봅시다. 실제 학습 시에는 진짜 이미지를 사용해야
하지만, 이 튜토리얼에서는 가짜 입력 데이터를 사용하며
실제 데이터를 읽어들이는 것에 대해서는 신경 쓰지 않을 것입니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">IMAGE_SIZE</span> <span class="o">=</span> <span class="mi">224</span>

<span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">):</span>
  <span class="c1"># 가짜 이미지 입력값 생성: tensor의 형태는 batch_size, channels, height, width</span>
  <span class="n">fake_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">IMAGE_SIZE</span><span class="p">,</span> <span class="n">IMAGE_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

  <span class="c1"># forward와 backward 호출</span>
  <span class="n">loss</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">fake_image</span><span class="p">)</span>
  <span class="n">loss</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

  <span class="c1"># 옵티마이저 업데이트</span>
  <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
  <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</pre></div>
</div>
<section id="id2">
<h2>학습 중의 메모리 사용량<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>이제 메모리 스냅샷을 확인하려고 하므로, 이를 적절히 분석할 준비를 해야 합니다.
일반적으로 학습 메모리는 다음으로 구성됩니다:</p>
<blockquote>
<div><ul class="simple">
<li><p>모델 매개변수 (크기 P)</p></li>
<li><p>backward pass를 위해 저장된 활성화 값(activations) (크기 A)</p></li>
<li><p>변화도, 모델 매개변수와 같은 크기이므로 크기 G = P.</p></li>
<li><p>옵티마이저 상태, 매개변수 크기에 비례합니다. 예시의 경우,
Adam의 상태는 모델 매개변수의 2배가 필요하므로 크기 O = 2P.</p></li>
<li><p>중간 단계(Intermediate) tensor, 계산 도중 할당됩니다.
보통 크기가 작고 일시적이므로 지금은 신경 쓰지 않겠습니다.</p></li>
</ul>
</div></blockquote>
</section>
<section id="id3">
<h2>메모리 스냅샷 캡처 및 시각화<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>이제 메모리 스냅샷을 가져와 봅시다! 코드가 실행되는 동안,
CUDA 메모리 타임라인이 어떤 모습일지 한 번 예상해 보세요.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># CUDA에 메모리 할당 기록을 시작하도록 지시</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">_record_memory_history</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

<span class="c1"># 학습 3회 실시</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
  <span class="n">train</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>

<span class="c1"># 메모리 할당 스냅샷을 저장</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">_snapshot</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;snapshot.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">dump</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="c1"># CUDA에 메모리 할당 기록을 중지하도록 지시</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">_record_memory_history</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>이제 CUDA 메모리 시각화 도구(CUDA Memory Visualizer)에서 스냅샷을 열어보세요.
<a class="reference external" href="https://pytorch.org/memory_viz">https://pytorch.org/memory_viz</a> 로 들어가서 <code class="docutils literal notranslate"><span class="pre">snapshot.pickle</span></code> 파일을 드래그 앤
드롭하여 업로드할 수 있습니다. 메모리 타임라인이 예상과 일치하나요?</p>
<figure class="align-default">
<img alt="snapshot.png loaded into CUDA Memory Visualizer" src="../_images/snapshot.jpg" />
</figure>
<p>모델 매개변수는 이미 학습 루프 이전에 메모리에 로드되었으므로,
처음부터 가중치(weights)에 할당된 메모리 덩어리가 보입니다.
forward pass를 시작하면, 메모리는 활성화 값을 위해 점차 할당됩니다.
이 활성화 값은 backward pass에서 변화도를 계산하기 위해 저장하는 tensor입니다.
backward pass를 시작하면, 활성화 값이 점차 해제되면서 변화도가 차지하는 메모리가
쌓이기 시작합니다.</p>
<p>마지막으로 옵티마이저가 작동하면, 옵티마이저의 상태는 지연(lazily) 초기화되므로,
첫 번째 학습 루프의 옵티마이저 단계 동안만 옵티마이저 상태 메모리가 점차
증가하는 것을 볼 수 있습니다. 이후의 루프에서는, 옵티마이저 메모리가 그대로
유지되고, 제자리에서 업데이트됩니다. 변화도가 차지하는 메모리는 매번 학습 루프가
끝날 때에 맞춰 <code class="docutils literal notranslate"><span class="pre">zero_grad</span></code> 가 호출되면 해제됩니다.</p>
<p>이 학습 루프에서 메모리 병목 현상이 발생하는 지점은 어디일까요? 즉, 메모리
사용이 가장 높은 지점은 어디일까요?</p>
<p>메모리 사용량이 가장 높은 지점은 옵티마이저 단계입니다! 이때의 메모리를 보면 예상대로
~1.2GB 의 매개변수, ~1.2GB의 변화도, 그리고 ~2.4GB=2*1.2GB 의 옵티마이저 상태로
구성됩니다. 마지막 ~1.2GB는 Adam 옵티마이저가 중간 단계에 필요로 하는 메모리로,
합쳐서 총 ~6GB에 달합니다.
사실, <code class="docutils literal notranslate"><span class="pre">Adam(model.parameters(),</span> <span class="pre">foreach=False)</span></code> 로 설정하면 옵티마이저 중간
메모리인 마지막 1.2GB를 제거할 수 있는데, 이는 메모리 대신 실행 시간을 희생하는
방식입니다. 만약 이 <code class="docutils literal notranslate"><span class="pre">foreach</span></code> 최적화만으로도 충분히 필요한만큼 메모리가
절약되었다면 잘된 일이지만,
더 나은 방법에 대해 알고 싶다면 이 튜토리얼을 계속 읽어보세요!
이제 곧 소개할 방법을 사용한다면, ~1.2GB의 <strong>변화도 메모리</strong> 와 <strong>옵티마이저 중간
단계 메모리</strong> 가 필요 없게 되어 최대 메모리 사용량을 낮출 수 있습니다.
그렇다면, 새로운 최대 메모리 사용량은 얼마가 될까요?
정답은 <cite>다음</cite> 스냅샷에서 공개됩니다.</p>
</section>
<section id="id4">
<h2>주의 사항: 이 방법은 모든 경우에 적합한 것은 <strong>아님</strong><a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>잠시 진정하고, 먼저 이 방법이 <cite>당신</cite> 의 사용 사례에 적합한지 고려해야 합니다.
이 방법은 결코 만능 해결책이 아닙니다!
옵티마이저 단계를 backward 과정에 합치는 이 방법은 <em>변화도</em> 메모리의 감소만을 목표로
합니다 (그리고 부수적으로 옵티마이저 중간 단계 메모리도 줄입니다).
따라서 변화도가 차지하는 메모리가 클수록, 메모리 절약 효과가 더욱 커집니다.
위의 예시에서 변화도는 메모리 총량의 20%를 차지하는데, 이는 꽤나 큰 비율이죠!</p>
<p>그러나 때에 따라 이러한 상황에 해당하지 않을 수 있습니다. 예를 들어, 이미
가중치가 매우 작다면 (LoRa 적용 등의 이유로), 변화도가 학습 루프에서 공간을 많이
차지하지 않을 것이고, 그렇다면 이 방법의 이점이 그다지 크지 않을 수 있습니다.
이런 경우에는 먼저 활성화 값 체크포인팅, 분산 학습, 양자화, 배치 크기 축소와 같은
다른 기술을 시도해 보세요. 그런 다음, 변화도가 다시 병목의 일부가 될 때
이 튜토리얼로 돌아오세요!</p>
<p>아직 여기에 계신가요? 좋습니다, 이제 Tensor의 새로운 <code class="docutils literal notranslate"><span class="pre">register_post_accumulate_grad_hook(hook)</span></code>
API를 소개하겠습니다.</p>
</section>
<section id="tensor-register-post-accumulate-grad-hook-hook-api">
<h2><code class="docutils literal notranslate"><span class="pre">Tensor.register_post_accumulate_grad_hook(hook)</span></code> API와 우리가 사용할 방법<a class="headerlink" href="#tensor-register-post-accumulate-grad-hook-hook-api" title="Link to this heading">#</a></h2>
<p>이 방법은 <code class="docutils literal notranslate"><span class="pre">backward()</span></code> 동안 변화도를 저장하지 않아도 된다는 점에 의존합니다.
대신, 기울기가 누적되면 즉시 해당 매개변수에 대해 옵티마이저를 적용하고, 해당
변화도를 완전히 제거합니다! 이렇게 하면 옵티마이저 단계를 위해 큰 변화도 버퍼를
유지할 필요가 없어집니다.</p>
<p>그렇다면 옵티마이저를 더 즉시(eagerly) 적용하는 동작을 어떻게 하면 활성화할 수 있을까요? 2.1
버전에서 새로 추가된 API인 <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.Tensor.register_post_accumulate_grad_hook()</span></code>
을 사용하면, Tensor의 <code class="docutils literal notranslate"><span class="pre">.grad</span></code>  필드(field)가 누적된 후에 훅(hook)을 추가할 수 있습니다.
우리는 이 훅에 옵티마이저 단계를 캡슐화(encapsulate)할 것입니다. 어떻게요?</p>
</section>
<section id="id5">
<h2>이 모든 것을 단 10줄의 코드로 통합하는 방법<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>초반에 사용했던 모델과 옵티마이저 설정을 기억하시나요? 코드 재실행에 리소스를
낭비하지 않도록 아래에 주석으로 남겨두겠습니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">vit_l_16</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># *단일* 옵티마이저 대신, 각 매개변수마다 하나씩 옵티마이저를 만들고 ``딕셔너리``</span>
<span class="c1"># 하나에 저장하여 훅에서 참조할 수 있도록 하겠습니다.</span>
<span class="n">optimizer_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">([</span><span class="n">p</span><span class="p">],</span> <span class="n">foreach</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">()}</span>

<span class="c1"># 옵티마이저의 ``step()`` 및 ``zero_grad()`` 를 호출할 훅을 정의합니다.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">optimizer_hook</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
  <span class="n">optimizer_dict</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
  <span class="n">optimizer_dict</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

<span class="c1"># 모든 매개변수에 훅을 등록합니다.</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
   <span class="n">p</span><span class="o">.</span><span class="n">register_post_accumulate_grad_hook</span><span class="p">(</span><span class="n">optimizer_hook</span><span class="p">)</span>

<span class="c1"># 이전의 ``train()`` 함수 기억하시나요? 옵티마이저가 backward에 합쳐졌으므로,</span>
<span class="c1"># 옵티마이저의 step 및 zero_grad 호출을 제거할 수 있습니다.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
  <span class="c1"># 가짜 이미지 입력값 생성: tensor의 형태는 batch_size, channels, height, width</span>
  <span class="n">fake_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">IMAGE_SIZE</span><span class="p">,</span> <span class="n">IMAGE_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

  <span class="c1"># forward와 backward 호출</span>
  <span class="n">loss</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">fake_image</span><span class="p">)</span>
  <span class="n">loss</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

  <span class="c1"># 옵티마이저 업데이트 --&gt; 이제 필요 없습니다!</span>
  <span class="c1"># optimizer.step()</span>
  <span class="c1"># optimizer.zero_grad()</span>
</pre></div>
</div>
<p>샘플 모델에서는 약 10줄의 코드 변경으로 끝났습니다. 깔끔하네요.
하지만 실제 모델에서는 옵티마이저를 옵티마이저 딕셔너리로 교체하는 것이
꽤나 거슬리는 변경이 될 수 있습니다.
특히 <code class="docutils literal notranslate"><span class="pre">LRScheduler</span></code> 를 사용하거나 학습 에폭 동안 옵티마이저 구성을
조작하는 경우에는 더욱 그렇습니다.
그러한 상황에서 이 API를 사용하려면 더 복잡할 것이고, 더 많은 구성 요소를
전역(global) 상태로 이동시켜야 할 수도 있지만, 불가능하지는 않을 것입니다.
그렇긴 하지만, 조만간 PyTorch가 이 API를 LRScheduler나 기존의 다른
기능들과 더 쉽게 통합할 수 있도록 이 API를 개선하길 바라 봅니다.</p>
<p>다시 돌아와서, 이 방법이 써볼 만한 가치가 있다는 설득을 이어 나가 보겠습니다.
우리의 친구, 메모리 스냅샷을 살펴보겠습니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 이전의 옵티마이저 메모리를 삭제하여 다음 메모리 스냅샷을 위한 깨끗한 상태를</span>
<span class="c1"># 만듭니다.</span>
<span class="k">del</span> <span class="n">optimizer</span>

<span class="c1"># CUDA에 메모리 할당 기록을 시작하도록 지시</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">_record_memory_history</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

<span class="c1"># 학습 3회 실시. 이제 더 이상 train() 함수에 옵티마이저를 전달하지 않는다는 점에 유의하세요.</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
  <span class="n">train</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># 메모리 할당 스냅샷을 저장</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">_snapshot</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;snapshot-opt-in-bwd.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">dump</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="c1"># CUDA에 메모리 할당 기록을 중지하도록 지시</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">_record_memory_history</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>좋아요, CUDA Memory Visualizer에 스냅샷을 드래그 앤 드롭해 봅시다.</p>
<figure class="align-default">
<img alt="snapshot.png loaded into CUDA Memory Visualizer" src="../_images/snapshot_opt_in_bwd.jpg" />
</figure>
<dl class="simple">
<dt>몇 가지 주요 관찰 사항:</dt><dd><ol class="arabic simple">
<li><p>더 이상 옵티마이저 단계가 없습니다! 맞아요… backward 과정에 합쳐졌죠.</p></li>
<li><p>마찬가지로, backward 과정이 더 길어지고 중간 단계를 위한 임시 메모리 할당이 더
많아졌습니다. 이는 예상된 결과인데, 옵티마이저 단계가 중간 단계를 필요로 하기
때문입니다.</p></li>
<li><p>가장 중요한 점! 최대 메모리 사용량이 낮아졌습니다! 이제 ~4GB 정도입니다
(예상하셨던 수치와 얼추 비슷하길 바랍니다).</p></li>
</ol>
</dd>
</dl>
<p>더 이상 변화도를 위해 할당된 큰 메모리 덩어리가 없다는 점에 주목하세요.
이에 따라 이전과 비교해 보았을 때 ~1.2GB 의 메모리 절약이 이루어졌습니다. 대신,
변화도가 계산되자마자 매우 빠르게 해제되었는데, 이는 가능한 한 옵티마이저 단계를
앞당겼기 때문입니다. 야호! 참고로, 나머지 ~1.2GB 의 메모리 절약은 옵티마이저를
매개변수별 옵티마이저로 나누면서 중간 단계의 메모리 사용량이 줄어든 덕분입니다.
하지만 이것은 기울기 메모리 절약보다는 <cite>덜 중요한</cite> 부분인데, 왜냐하면 중간 단계의
메모리 절약은 이 기술 없이도 <code class="docutils literal notranslate"><span class="pre">foreach=False</span></code> 옵션을 수정해 주는 것만으로
달성할 수 있기 때문입니다.</p>
<p>이런 의문이 생길 수 있습니다: 2.4GB의 메모리가 절약되었다면, 왜 최대 메모리 사용량이
6GB - 2.4GB = 3.6GB가 아닌가요? 아, 그건 최대 메모리 사용량의 시점이 바뀌었기 때문입니다!
최대 메모리 사용량은 이제 backward 과정의 시작 부분으로 이동했습니다. 이제는 이 시점에
메모리에 활성화 값이 남아있으며, 이전에는 옵티마이저 단계에서 활성화 값이 해제된 후 최대
메모리 사용량이 발생했습니다. ~4.0GB와 ~3.6GB 간의 ~0.4GB의 차이는 바로 이 활성화 값의
메모리 때문입니다. 따라서 이 기술을 활성화 값 체크포인팅과 함께 사용하면 더 큰 메모리
절약을 이룰 수 있을 것입니다.</p>
</section>
<section id="id6">
<h2>결론<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<p>이번 튜토리얼에서는 새로운 <code class="docutils literal notranslate"><span class="pre">Tensor.register_post_accumulate_grad_hook()</span></code>
API를 사용하여 옵티마이저를 backward 단계에 합치는 메모리 절약 기술과 이를 <em>언제</em>
적용해야 하는지(변화도 메모리 양이 상당한 경우)에 대해 배웠습니다. 또한 메모리
최적화에 일반적으로 유용한 메모리 스냅샷에 대해서도 학습했습니다.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (1 minutes 44.579 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-intermediate-optimizer-step-in-backward-tutorial-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/dfe0a5e2472fa9d26daaa0f82eefb5b6/optimizer_step_in_backward_tutorial.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">optimizer_step_in_backward_tutorial.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/678a3ee2efc3fad76b565fdd254b297d/optimizer_step_in_backward_tutorial.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">optimizer_step_in_backward_tutorial.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b04f7e6a93c00c90f510ed45c058d7cb/optimizer_step_in_backward_tutorial.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">optimizer_step_in_backward_tutorial.zip</span></code></a></p>
</div>
</div>
</section>
</section>


                </article>
              
  </article>
  
              
              
                <footer class="bd-footer-article">
                  <div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item">
<div class="feedback">
  
<div class="rating">
    Rate this Page
    <div class="stars">
        
        <span class="star" data-behavior="tutorial-rating" data-count="1" data-value="1">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="2" data-value="2">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="3" data-value="3">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="4" data-value="4">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="5" data-value="5">★</span>
        
    </div>
</div>

  <div class="feedback-send">
    <button class="feedback-btn"
            onclick="openGitHubIssue()"
            data-bs-title="Create a GitHub Issue"
            data-bs-placement="bottom"
            data-bs-toggle="tooltip"
            data-gtm="feedback-btn-click">Send Feedback
    </button>
  </div>
</div>

<div class="prev-next-area">
</div>

<div class="footer-info">
  <p class="copyright">
    
      
        © Copyright 2018-2025, PyTorch &amp; 파이토치 한국 사용자 모임(PyTorchKR).
      
      <br/>
    
  </p>

  <p class="theme-version">
    Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
  </p>
</div>
</div>
  
</div>
                </footer>
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc">
<div class="sidebar-secondary-items sidebar-secondary__inner">
    
       <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">학습 중의 메모리 사용량</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">메모리 스냅샷 캡처 및 시각화</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">주의 사항: 이 방법은 모든 경우에 적합한 것은 <strong>아님</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tensor-register-post-accumulate-grad-hook-hook-api"><code class="docutils literal notranslate"><span class="pre">Tensor.register_post_accumulate_grad_hook(hook)</span></code> API와 우리가 사용할 방법</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">이 모든 것을 단 10줄의 코드로 통합하는 방법</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">결론</a></li>
</ul>
  </nav></div>
    




<div class="sidebar-secondary-item">
  <div class="sidebar-heading">PyTorch Libraries</div>
  <ul style="list-style-type: none; padding: 0; padding-bottom: 80px;">
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/ao" style="color: var(--pst-color-text-muted)">torchao</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/torchrec" style="color: var(--pst-color-text-muted)">torchrec</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/torchft" style="color: var(--pst-color-text-muted)">torchft</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/torchcodec" style="color: var(--pst-color-text-muted)">TorchCodec</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/vision" style="color: var(--pst-color-text-muted)">torchvision</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/executorch" style="color: var(--pst-color-text-muted)">ExecuTorch</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/xla" style="color: var(--pst-color-text-muted)">PyTorch on XLA Devices</a></li>
  
  </ul>
</div>

</div>
</div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <div class="container-fluid docs-tutorials-resources">
  <div class="container">
    <div class="row">
      <div class="col-md-4 text-center">
        <h2>PyTorchKorea @ GitHub</h2>
        <p>파이토치 한국 사용자 모임을 GitHub에서 만나보세요.</p>
        <a class="with-right-arrow" href="https://github.com/PyTorchKorea">GitHub로 이동</a>
      </div>

      <div class="col-md-4 text-center">
        <h2>한국어 튜토리얼</h2>
        <p>한국어로 번역 중인 파이토치 튜토리얼을 만나보세요.</p>
        <a class="with-right-arrow" href="https://tutorials.pytorch.kr/">튜토리얼로 이동</a>
      </div>

      <div class="col-md-4 text-center">
        <h2>한국어 커뮤니티</h2>
        <p>다른 사용자들과 의견을 나누고, 도와주세요!</p>
        <a class="with-right-arrow" href="https://discuss.pytorch.kr/">커뮤니티로 이동</a>
      </div>
    </div>
  </div>
</div>

<footer class="site-footer">
  <div class="container footer-container">
    <div class="footer-logo-wrapper">
      <a href="https://pytorch.kr/" class="footer-logo"></a>
    </div>

    <div class="footer-links-wrapper">
      <div class="footer-links-col">
        <ul>
          <li class="list-title"><a href="https://pytorch.kr/">파이토치 한국 사용자 모임</a></li>
          <li><a href="https://pytorch.kr/about">사용자 모임 소개</a></li>
          <li><a href="https://pytorch.kr/contributors">기여해주신 분들</a></li>
          <li><a href="https://pytorch.kr/resources/">리소스</a></li>
          <li><a href="https://pytorch.kr/coc">행동 강령</a></li>
        </ul>
      </div>
    </div>

    <div class="trademark-disclaimer">
      <ul>
        <li>이 사이트는 독립적인 파이토치 사용자 커뮤니티로, 최신 버전이 아니거나 잘못된 내용이 포함되어 있을 수 있습니다. This site is an independent user community and may be out of date or contain incorrect information.</li>
        <li><a href="https://pytorch.kr/coc">행동 강령</a>을 읽고 지켜주세요. PyTorch 공식 로고 사용 규정은 <a href="https://www.linuxfoundation.org/policies/">Linux Foundation의 정책</a>을 따릅니다. Please read and follow <a href="https://pytorch.kr/coc">our code of conduct</a>. All PyTorch trademark policy applicable to <a href="https://www.linuxfoundation.org/policies/">Linux Foundation's policies</a>.</li>
      </ul>
    </div>
  </div>
</footer>

<div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../_static/img/pytorch-x.svg">
  </div>
</div>
  
  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2018-2025, PyTorch &amp; 파이토치 한국 사용자 모임(PyTorchKR).
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6 버전으로 생성되었습니다.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  <script type="application/ld+json">
    {
       "@context": "https://schema.org",
       "@type": "Article",
       "name": "\uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\ub97c backward pass\uc5d0 \ud569\uccd0\uc11c \uba54\ubaa8\ub9ac \uc808\uc57d\ud558\uae30",
       "headline": "\uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\ub97c backward pass\uc5d0 \ud569\uccd0\uc11c \uba54\ubaa8\ub9ac \uc808\uc57d\ud558\uae30",
       "description": "PyTorch Documentation. Explore PyTorch, an open-source machine learning library that accelerates the path from research prototyping to production deployment. Discover tutorials, API references, and guides to help you build and deploy deep learning models efficiently.",
       "url": "/intermediate/optimizer_step_in_backward_tutorial.html",
       "articleBody": "\ucc38\uace0 Go to the end to download the full example code. \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\ub97c backward pass\uc5d0 \ud569\uccd0\uc11c \uba54\ubaa8\ub9ac \uc808\uc57d\ud558\uae30# \ubc88\uc5ed: \ud558\ub3d9\ud6c8 \uc548\ub155\ud558\uc138\uc694! \uc774 \ud29c\ud1a0\ub9ac\uc5bc\uc5d0\uc11c\ub294 \ubcc0\ud654\ub3c4(gradient) \uac00 \ucc28\uc9c0\ud558\ub294 \uba54\ubaa8\ub9ac\ub97c \uc904\uc784\uc73c\ub85c\uc368 \ud559\uc2b5 \ub8e8\ud504(training loop)\uc5d0\uc11c\uc758 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc744 \uc904\uc774\ub294 \ud55c \uac00\uc9c0 \ubc29\ubc95\uc744 \uc18c\uac1c\ud569\ub2c8\ub2e4. \ubaa8\ub378\uc774 \uc788\ub294 \uc0c1\ud669\uc5d0\uc11c \uba54\ubaa8\ub9ac \ucd5c\uc801\ud654\ub97c \ud1b5\ud574 \uba54\ubaa8\ub9ac \ubd80\uc871(Out of Memory, OOM) \uc624\ub958\ub97c \ubc29\uc9c0\ud558\uace0 \uc2f6\uac70\ub098, GPU\uc758 \uc131\ub2a5\uc744 \ucd5c\ub300\ud55c \ud65c\uc6a9\ud558\uace0 \uc2f6\uc740 \uacbd\uc6b0 \uc774 \ubc29\ubc95\uc774 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4 (\ubcc0\ud654\ub3c4\uac00 \uba54\ubaa8\ub9ac\uc758 \uc77c\ubd80\ubd84\uc744 \ucc28\uc9c0\ud558\uace0 \uc788\uc73c\uba70, \ubcc0\ud654\ub3c4 \ub204\uc801(accumulation)\uc774 \ud544\uc694\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0\ub77c\uba74 \ub9d0\uc785\ub2c8\ub2e4). \uc774 \ud29c\ud1a0\ub9ac\uc5bc\uc740 \ub2e4\uc74c \ub0b4\uc6a9\uc744 \ub2e4\ub8f9\ub2c8\ub2e4: \ud559\uc2b5 \ub610\ub294 \ubbf8\uc138 \uc870\uc815(finetuning) \ub8e8\ud504\uc5d0\uc11c \uba54\ubaa8\ub9ac\ub97c \ucc28\uc9c0\ud558\ub294 \uc694\uc18c, \ubcd1\ubaa9 \ud604\uc0c1\uc744 \ud30c\uc545\ud558\uae30 \uc704\ud574 \uba54\ubaa8\ub9ac \uc2a4\ub0c5\uc0f7(snapshot)\uc744 \ucea1\ucc98\ud558\uace0 \uc2dc\uac01\ud654\ud558\ub294 \ubc29\ubc95, \uc0c8\ub85c\uc6b4 Tensor.register_post_accumulate_grad_hook(hook) API, \uc774 \ubaa8\ub4e0 \uac83\uc744 \uac10\uc548\ud55c \ub2e8 10\uc904\uc758 \ucf54\ub4dc\ub85c \uba54\ubaa8\ub9ac\ub97c \uc808\uc57d\ud558\ub294 \ubc29\ubc95. \uc774 \ud29c\ud1a0\ub9ac\uc5bc\uc744 \uc2e4\ud589\ud558\uae30 \uc704\ud574 \ud544\uc694\ud55c \uac83: 2.1.0 \ud639\uc740 \uadf8 \uc774\uc0c1\uc758 \ubc84\uc804\uc758 PyTorch\uc640 torchvision \uba54\ubaa8\ub9ac \uc2dc\uac01\ud654\ub97c \ub85c\uceec\uc5d0\uc11c \uc2e4\ud589\ud558\ub824\uba74, CUDA GPU 1\uac1c. \uba54\ubaa8\ub9ac \uc2dc\uac01\ud654\ub97c \uc81c\uc678\ud558\uba74 \uc774 \ucd5c\uc801\ud654 \ubc29\ubc95\uc740 \ubaa8\ub4e0 \uc7a5\uce58\uc5d0\uc11c \uc720\uc0ac\ud55c \uc774\uc810\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uba3c\uc800 \ud544\uc694\ud55c \ubaa8\ub4c8\uacfc \ubaa8\ub378\uc744 import \ud558\uaca0\uc2b5\ub2c8\ub2e4. \uc5ec\uae30\uc5d0\uc11c\ub294 torchvision\uc758 \ube44\uc804 \ud2b8\ub79c\uc2a4\ud3ec\uba38 \ubaa8\ub378\uc744 \uc0ac\uc6a9\ud558\uc9c0\ub9cc, \ub2e4\ub978 \ubaa8\ub378\ub85c \ub300\uccb4\ud574\ub3c4 \uc88b\uc2b5\ub2c8\ub2e4. \ub610 \uc635\ud2f0\ub9c8\uc774\uc800\ub85c torch.optim.Adam \uc744 \uc0ac\uc6a9\ud558\uc9c0\ub9cc, \ub9c8\ucc2c\uac00\uc9c0\ub85c \ub2e4\ub978 \uc635\ud2f0\ub9c8\uc774\uc800\ub85c \ub300\uccb4\ud574\ub3c4 \ub429\ub2c8\ub2e4. import torch from torchvision import models from pickle import dump model = models.vit_l_16(weights=\u0027DEFAULT\u0027).cuda() optimizer = torch.optim.Adam(model.parameters()) Downloading: \"https://download.pytorch.org/models/vit_l_16-852ce7e3.pth\" to /root/.cache/torch/hub/checkpoints/vit_l_16-852ce7e3.pth 0%| | 0.00/1.13G [00:00\u003c?, ?B/s] 0%| | 128k/1.13G [00:00\u003c1:23:49, 242kB/s] 0%| | 384k/1.13G [00:00\u003c32:10, 630kB/s] 0%| | 640k/1.13G [00:00\u003c22:48, 889kB/s] 0%| | 1.12M/1.13G [00:01\u003c13:23, 1.51MB/s] 0%| | 2.25M/1.13G [00:01\u003c06:37, 3.05MB/s] 0%| | 4.50M/1.13G [00:01\u003c03:18, 6.10MB/s] 1%| | 8.38M/1.13G [00:01\u003c01:49, 11.0MB/s] 1%| | 12.1M/1.13G [00:01\u003c01:24, 14.2MB/s] 1%|\u258f | 16.0M/1.13G [00:01\u003c01:12, 16.6MB/s] 2%|\u258f | 19.9M/1.13G [00:02\u003c01:05, 18.3MB/s] 2%|\u258f | 23.8M/1.13G [00:02\u003c01:01, 19.3MB/s] 2%|\u258f | 27.6M/1.13G [00:02\u003c00:58, 20.2MB/s] 3%|\u258e | 31.5M/1.13G [00:02\u003c00:57, 20.8MB/s] 3%|\u258e | 35.4M/1.13G [00:02\u003c00:55, 21.2MB/s] 3%|\u258e | 39.2M/1.13G [00:03\u003c00:55, 21.4MB/s] 4%|\u258e | 43.0M/1.13G [00:03\u003c00:54, 21.4MB/s] 4%|\u258d | 46.9M/1.13G [00:03\u003c00:54, 21.6MB/s] 4%|\u258d | 50.6M/1.13G [00:03\u003c00:53, 21.6MB/s] 5%|\u258d | 54.5M/1.13G [00:03\u003c00:53, 21.7MB/s] 5%|\u258c | 58.4M/1.13G [00:04\u003c00:52, 21.9MB/s] 5%|\u258c | 62.1M/1.13G [00:04\u003c00:53, 21.7MB/s] 6%|\u258c | 66.0M/1.13G [00:04\u003c00:52, 21.8MB/s] 6%|\u258c | 69.9M/1.13G [00:04\u003c00:52, 21.9MB/s] 6%|\u258b | 73.8M/1.13G [00:04\u003c00:52, 21.9MB/s] 7%|\u258b | 77.6M/1.13G [00:04\u003c00:51, 22.0MB/s] 7%|\u258b | 81.5M/1.13G [00:05\u003c00:51, 21.9MB/s] 7%|\u258b | 85.4M/1.13G [00:05\u003c00:51, 22.0MB/s] 8%|\u258a | 89.1M/1.13G [00:05\u003c00:51, 21.8MB/s] 8%|\u258a | 93.0M/1.13G [00:05\u003c00:51, 21.9MB/s] 8%|\u258a | 96.9M/1.13G [00:05\u003c00:50, 22.0MB/s] 9%|\u258a | 101M/1.13G [00:06\u003c00:50, 21.8MB/s] 9%|\u2589 | 104M/1.13G [00:06\u003c00:50, 21.9MB/s] 9%|\u2589 | 108M/1.13G [00:06\u003c00:50, 21.9MB/s] 10%|\u2589 | 112M/1.13G [00:06\u003c00:49, 22.0MB/s] 10%|\u2589 | 116M/1.13G [00:06\u003c00:50, 21.7MB/s] 10%|\u2588 | 120M/1.13G [00:06\u003c00:49, 21.9MB/s] 11%|\u2588 | 124M/1.13G [00:07\u003c00:49, 22.0MB/s] 11%|\u2588 | 128M/1.13G [00:07\u003c00:49, 22.0MB/s] 11%|\u2588\u258f | 132M/1.13G [00:07\u003c00:48, 22.1MB/s] 12%|\u2588\u258f | 135M/1.13G [00:07\u003c00:48, 22.1MB/s] 12%|\u2588\u258f | 139M/1.13G [00:07\u003c00:48, 21.9MB/s] 12%|\u2588\u258f | 143M/1.13G [00:08\u003c00:48, 21.9MB/s] 13%|\u2588\u258e | 147M/1.13G [00:08\u003c00:48, 21.8MB/s] 13%|\u2588\u258e | 151M/1.13G [00:08\u003c00:48, 21.9MB/s] 13%|\u2588\u258e | 154M/1.13G [00:08\u003c00:48, 21.9MB/s] 14%|\u2588\u258e | 158M/1.13G [00:08\u003c00:49, 21.2MB/s] 14%|\u2588\u258d | 162M/1.13G [00:08\u003c00:49, 21.3MB/s] 14%|\u2588\u258d | 166M/1.13G [00:09\u003c00:48, 21.5MB/s] 15%|\u2588\u258d | 169M/1.13G [00:09\u003c00:47, 21.7MB/s] 15%|\u2588\u258d | 173M/1.13G [00:09\u003c00:47, 21.6MB/s] 15%|\u2588\u258c | 177M/1.13G [00:09\u003c00:47, 21.7MB/s] 16%|\u2588\u258c | 181M/1.13G [00:09\u003c00:47, 21.9MB/s] 16%|\u2588\u258c | 185M/1.13G [00:10\u003c00:46, 21.9MB/s] 16%|\u2588\u258c | 188M/1.13G [00:10\u003c00:46, 21.8MB/s] 17%|\u2588\u258b | 192M/1.13G [00:10\u003c00:46, 21.9MB/s] 17%|\u2588\u258b | 196M/1.13G [00:10\u003c00:46, 21.7MB/s] 17%|\u2588\u258b | 200M/1.13G [00:10\u003c00:45, 22.0MB/s] 18%|\u2588\u258a | 204M/1.13G [00:11\u003c00:46, 21.8MB/s] 18%|\u2588\u258a | 208M/1.13G [00:11\u003c00:45, 21.9MB/s] 18%|\u2588\u258a | 212M/1.13G [00:11\u003c00:45, 22.0MB/s] 19%|\u2588\u258a | 216M/1.13G [00:11\u003c00:45, 21.9MB/s] 19%|\u2588\u2589 | 219M/1.13G [00:11\u003c00:44, 22.1MB/s] 19%|\u2588\u2589 | 223M/1.13G [00:11\u003c00:44, 22.1MB/s] 20%|\u2588\u2589 | 227M/1.13G [00:12\u003c00:44, 22.1MB/s] 20%|\u2588\u2589 | 231M/1.13G [00:12\u003c00:44, 21.9MB/s] 20%|\u2588\u2588 | 235M/1.13G [00:12\u003c00:44, 21.9MB/s] 21%|\u2588\u2588 | 239M/1.13G [00:12\u003c00:44, 21.9MB/s] 21%|\u2588\u2588 | 242M/1.13G [00:12\u003c00:43, 22.0MB/s] 21%|\u2588\u2588 | 246M/1.13G [00:13\u003c00:43, 22.0MB/s] 22%|\u2588\u2588\u258f | 250M/1.13G [00:13\u003c00:43, 21.8MB/s] 22%|\u2588\u2588\u258f | 254M/1.13G [00:13\u003c00:43, 21.9MB/s] 22%|\u2588\u2588\u258f | 258M/1.13G [00:13\u003c00:43, 21.9MB/s] 23%|\u2588\u2588\u258e | 262M/1.13G [00:13\u003c00:42, 22.0MB/s] 23%|\u2588\u2588\u258e | 266M/1.13G [00:13\u003c00:42, 22.0MB/s] 23%|\u2588\u2588\u258e | 269M/1.13G [00:14\u003c00:42, 21.9MB/s] 24%|\u2588\u2588\u258e | 273M/1.13G [00:14\u003c00:42, 21.9MB/s] 24%|\u2588\u2588\u258d | 277M/1.13G [00:14\u003c00:42, 21.9MB/s] 24%|\u2588\u2588\u258d | 281M/1.13G [00:14\u003c00:42, 21.8MB/s] 25%|\u2588\u2588\u258d | 285M/1.13G [00:14\u003c00:42, 21.9MB/s] 25%|\u2588\u2588\u258d | 289M/1.13G [00:15\u003c00:41, 22.0MB/s] 25%|\u2588\u2588\u258c | 292M/1.13G [00:15\u003c00:41, 22.0MB/s] 26%|\u2588\u2588\u258c | 296M/1.13G [00:15\u003c00:41, 22.1MB/s] 26%|\u2588\u2588\u258c | 300M/1.13G [00:15\u003c00:40, 22.1MB/s] 26%|\u2588\u2588\u258c | 304M/1.13G [00:15\u003c00:41, 21.9MB/s] 27%|\u2588\u2588\u258b | 308M/1.13G [00:15\u003c00:40, 22.0MB/s] 27%|\u2588\u2588\u258b | 312M/1.13G [00:16\u003c00:40, 22.0MB/s] 27%|\u2588\u2588\u258b | 316M/1.13G [00:16\u003c00:40, 22.0MB/s] 28%|\u2588\u2588\u258a | 319M/1.13G [00:16\u003c00:40, 21.9MB/s] 28%|\u2588\u2588\u258a | 323M/1.13G [00:16\u003c00:40, 21.9MB/s] 28%|\u2588\u2588\u258a | 327M/1.13G [00:16\u003c00:39, 22.0MB/s] 29%|\u2588\u2588\u258a | 331M/1.13G [00:17\u003c00:39, 22.0MB/s] 29%|\u2588\u2588\u2589 | 335M/1.13G [00:17\u003c00:39, 21.8MB/s] 29%|\u2588\u2588\u2589 | 339M/1.13G [00:17\u003c00:39, 21.9MB/s] 29%|\u2588\u2588\u2589 | 342M/1.13G [00:17\u003c00:39, 22.0MB/s] 30%|\u2588\u2588\u2589 | 346M/1.13G [00:17\u003c00:38, 22.0MB/s] 30%|\u2588\u2588\u2588 | 350M/1.13G [00:17\u003c00:38, 22.0MB/s] 31%|\u2588\u2588\u2588 | 354M/1.13G [00:18\u003c00:38, 22.1MB/s] 31%|\u2588\u2588\u2588 | 358M/1.13G [00:18\u003c00:38, 22.1MB/s] 31%|\u2588\u2588\u2588 | 362M/1.13G [00:18\u003c00:37, 22.1MB/s] 31%|\u2588\u2588\u2588\u258f | 366M/1.13G [00:18\u003c00:38, 21.9MB/s] 32%|\u2588\u2588\u2588\u258f | 370M/1.13G [00:18\u003c00:37, 22.0MB/s] 32%|\u2588\u2588\u2588\u258f | 373M/1.13G [00:19\u003c00:37, 22.0MB/s] 32%|\u2588\u2588\u2588\u258f | 377M/1.13G [00:19\u003c00:37, 22.0MB/s] 33%|\u2588\u2588\u2588\u258e | 381M/1.13G [00:19\u003c00:37, 22.1MB/s] 33%|\u2588\u2588\u2588\u258e | 385M/1.13G [00:19\u003c00:36, 22.1MB/s] 33%|\u2588\u2588\u2588\u258e | 389M/1.13G [00:19\u003c00:36, 21.9MB/s] 34%|\u2588\u2588\u2588\u258d | 393M/1.13G [00:20\u003c00:36, 22.0MB/s] 34%|\u2588\u2588\u2588\u258d | 396M/1.13G [00:20\u003c00:36, 22.0MB/s] 34%|\u2588\u2588\u2588\u258d | 400M/1.13G [00:20\u003c00:36, 22.0MB/s] 35%|\u2588\u2588\u2588\u258d | 404M/1.13G [00:20\u003c00:36, 21.9MB/s] 35%|\u2588\u2588\u2588\u258c | 408M/1.13G [00:20\u003c00:35, 22.1MB/s] 35%|\u2588\u2588\u2588\u258c | 412M/1.13G [00:20\u003c00:35, 21.9MB/s] 36%|\u2588\u2588\u2588\u258c | 416M/1.13G [00:21\u003c00:35, 22.0MB/s] 36%|\u2588\u2588\u2588\u258c | 420M/1.13G [00:21\u003c00:35, 22.0MB/s] 36%|\u2588\u2588\u2588\u258b | 423M/1.13G [00:21\u003c00:35, 21.8MB/s] 37%|\u2588\u2588\u2588\u258b | 427M/1.13G [00:21\u003c00:35, 21.9MB/s] 37%|\u2588\u2588\u2588\u258b | 431M/1.13G [00:21\u003c00:34, 22.0MB/s] 37%|\u2588\u2588\u2588\u258b | 435M/1.13G [00:22\u003c00:34, 22.0MB/s] 38%|\u2588\u2588\u2588\u258a | 439M/1.13G [00:22\u003c00:34, 22.0MB/s] 38%|\u2588\u2588\u2588\u258a | 443M/1.13G [00:22\u003c00:34, 22.0MB/s] 38%|\u2588\u2588\u2588\u258a | 447M/1.13G [00:22\u003c00:34, 21.9MB/s] 39%|\u2588\u2588\u2588\u2589 | 450M/1.13G [00:22\u003c00:34, 21.8MB/s] 39%|\u2588\u2588\u2588\u2589 | 454M/1.13G [00:22\u003c00:33, 21.9MB/s] 39%|\u2588\u2588\u2588\u2589 | 458M/1.13G [00:23\u003c00:33, 21.9MB/s] 40%|\u2588\u2588\u2588\u2589 | 462M/1.13G [00:23\u003c00:34, 21.6MB/s] 40%|\u2588\u2588\u2588\u2588 | 466M/1.13G [00:23\u003c00:33, 21.6MB/s] 40%|\u2588\u2588\u2588\u2588 | 469M/1.13G [00:23\u003c00:36, 20.1MB/s] 41%|\u2588\u2588\u2588\u2588 | 472M/1.13G [00:23\u003c00:34, 20.7MB/s] 41%|\u2588\u2588\u2588\u2588 | 476M/1.13G [00:24\u003c00:34, 21.1MB/s] 41%|\u2588\u2588\u2588\u2588\u258f | 480M/1.13G [00:24\u003c00:33, 21.4MB/s] 42%|\u2588\u2588\u2588\u2588\u258f | 484M/1.13G [00:24\u003c00:33, 21.4MB/s] 42%|\u2588\u2588\u2588\u2588\u258f | 488M/1.13G [00:24\u003c00:32, 21.4MB/s] 42%|\u2588\u2588\u2588\u2588\u258f | 492M/1.13G [00:24\u003c00:32, 21.6MB/s] 43%|\u2588\u2588\u2588\u2588\u258e | 496M/1.13G [00:24\u003c00:32, 21.8MB/s] 43%|\u2588\u2588\u2588\u2588\u258e | 499M/1.13G [00:25\u003c00:31, 21.8MB/s] 43%|\u2588\u2588\u2588\u2588\u258e | 503M/1.13G [00:25\u003c00:32, 21.5MB/s] 44%|\u2588\u2588\u2588\u2588\u258e | 507M/1.13G [00:25\u003c00:31, 21.6MB/s] 44%|\u2588\u2588\u2588\u2588\u258d | 511M/1.13G [00:25\u003c00:31, 21.8MB/s] 44%|\u2588\u2588\u2588\u2588\u258d | 515M/1.13G [00:25\u003c00:30, 21.9MB/s] 45%|\u2588\u2588\u2588\u2588\u258d | 519M/1.13G [00:26\u003c00:30, 22.0MB/s] 45%|\u2588\u2588\u2588\u2588\u258c | 522M/1.13G [00:26\u003c00:30, 22.0MB/s] 45%|\u2588\u2588\u2588\u2588\u258c | 526M/1.13G [00:26\u003c00:30, 22.0MB/s] 46%|\u2588\u2588\u2588\u2588\u258c | 530M/1.13G [00:26\u003c00:30, 22.0MB/s] 46%|\u2588\u2588\u2588\u2588\u258c | 534M/1.13G [00:26\u003c00:29, 22.0MB/s] 46%|\u2588\u2588\u2588\u2588\u258b | 538M/1.13G [00:27\u003c00:29, 22.0MB/s] 47%|\u2588\u2588\u2588\u2588\u258b | 542M/1.13G [00:27\u003c00:29, 22.1MB/s] 47%|\u2588\u2588\u2588\u2588\u258b | 546M/1.13G [00:27\u003c00:29, 22.1MB/s] 47%|\u2588\u2588\u2588\u2588\u258b | 550M/1.13G [00:27\u003c00:29, 22.1MB/s] 48%|\u2588\u2588\u2588\u2588\u258a | 554M/1.13G [00:27\u003c00:28, 22.1MB/s] 48%|\u2588\u2588\u2588\u2588\u258a | 557M/1.13G [00:27\u003c00:28, 21.9MB/s] 48%|\u2588\u2588\u2588\u2588\u258a | 561M/1.13G [00:28\u003c00:28, 21.9MB/s] 49%|\u2588\u2588\u2588\u2588\u258a | 565M/1.13G [00:28\u003c00:28, 22.0MB/s] 49%|\u2588\u2588\u2588\u2588\u2589 | 569M/1.13G [00:28\u003c00:28, 22.0MB/s] 49%|\u2588\u2588\u2588\u2588\u2589 | 573M/1.13G [00:28\u003c00:27, 22.0MB/s] 50%|\u2588\u2588\u2588\u2588\u2589 | 577M/1.13G [00:28\u003c00:27, 22.1MB/s] 50%|\u2588\u2588\u2588\u2588\u2589 | 580M/1.13G [00:29\u003c00:27, 22.1MB/s] 50%|\u2588\u2588\u2588\u2588\u2588 | 584M/1.13G [00:29\u003c00:27, 22.1MB/s] 51%|\u2588\u2588\u2588\u2588\u2588 | 588M/1.13G [00:29\u003c00:27, 22.1MB/s] 51%|\u2588\u2588\u2588\u2588\u2588 | 592M/1.13G [00:29\u003c00:26, 22.1MB/s] 51%|\u2588\u2588\u2588\u2588\u2588\u258f | 596M/1.13G [00:29\u003c00:26, 22.1MB/s] 52%|\u2588\u2588\u2588\u2588\u2588\u258f | 600M/1.13G [00:29\u003c00:26, 21.9MB/s] 52%|\u2588\u2588\u2588\u2588\u2588\u258f | 604M/1.13G [00:30\u003c00:26, 21.9MB/s] 52%|\u2588\u2588\u2588\u2588\u2588\u258f | 608M/1.13G [00:30\u003c00:26, 22.0MB/s] 53%|\u2588\u2588\u2588\u2588\u2588\u258e | 611M/1.13G [00:30\u003c00:26, 22.0MB/s] 53%|\u2588\u2588\u2588\u2588\u2588\u258e | 615M/1.13G [00:30\u003c00:25, 22.0MB/s] 53%|\u2588\u2588\u2588\u2588\u2588\u258e | 619M/1.13G [00:30\u003c00:25, 22.0MB/s] 54%|\u2588\u2588\u2588\u2588\u2588\u258e | 623M/1.13G [00:31\u003c00:25, 22.1MB/s] 54%|\u2588\u2588\u2588\u2588\u2588\u258d | 627M/1.13G [00:31\u003c00:25, 22.1MB/s] 54%|\u2588\u2588\u2588\u2588\u2588\u258d | 631M/1.13G [00:31\u003c00:25, 21.8MB/s] 55%|\u2588\u2588\u2588\u2588\u2588\u258d | 634M/1.13G [00:31\u003c00:25, 21.9MB/s] 55%|\u2588\u2588\u2588\u2588\u2588\u258d | 638M/1.13G [00:31\u003c00:24, 22.0MB/s] 55%|\u2588\u2588\u2588\u2588\u2588\u258c | 642M/1.13G [00:31\u003c00:24, 22.0MB/s] 56%|\u2588\u2588\u2588\u2588\u2588\u258c | 644M/1.13G [00:34\u003c02:06, 4.28MB/s] 56%|\u2588\u2588\u2588\u2588\u2588\u258c | 646M/1.13G [00:34\u003c01:52, 4.81MB/s] 56%|\u2588\u2588\u2588\u2588\u2588\u258c | 649M/1.13G [00:34\u003c01:25, 6.28MB/s] 56%|\u2588\u2588\u2588\u2588\u2588\u258b | 653M/1.13G [00:34\u003c01:03, 8.45MB/s] 57%|\u2588\u2588\u2588\u2588\u2588\u258b | 657M/1.13G [00:35\u003c00:49, 10.7MB/s] 57%|\u2588\u2588\u2588\u2588\u2588\u258b | 661M/1.13G [00:35\u003c00:41, 12.6MB/s] 57%|\u2588\u2588\u2588\u2588\u2588\u258b | 665M/1.13G [00:35\u003c00:34, 15.0MB/s] 58%|\u2588\u2588\u2588\u2588\u2588\u258a | 669M/1.13G [00:35\u003c00:31, 16.6MB/s] 58%|\u2588\u2588\u2588\u2588\u2588\u258a | 672M/1.13G [00:35\u003c00:28, 18.0MB/s] 58%|\u2588\u2588\u2588\u2588\u2588\u258a | 676M/1.13G [00:35\u003c00:26, 19.1MB/s] 59%|\u2588\u2588\u2588\u2588\u2588\u258a | 680M/1.13G [00:36\u003c00:25, 19.9MB/s] 59%|\u2588\u2588\u2588\u2588\u2588\u2589 | 684M/1.13G [00:36\u003c00:24, 20.5MB/s] 59%|\u2588\u2588\u2588\u2588\u2588\u2589 | 688M/1.13G [00:36\u003c00:23, 21.0MB/s] 60%|\u2588\u2588\u2588\u2588\u2588\u2589 | 692M/1.13G [00:36\u003c00:23, 21.3MB/s] 60%|\u2588\u2588\u2588\u2588\u2588\u2589 | 696M/1.13G [00:36\u003c00:22, 21.8MB/s] 60%|\u2588\u2588\u2588\u2588\u2588\u2588 | 700M/1.13G [00:37\u003c00:22, 21.7MB/s] 61%|\u2588\u2588\u2588\u2588\u2588\u2588 | 704M/1.13G [00:37\u003c00:22, 21.8MB/s] 61%|\u2588\u2588\u2588\u2588\u2588\u2588 | 707M/1.13G [00:37\u003c00:21, 21.9MB/s] 61%|\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 711M/1.13G [00:37\u003c00:21, 22.1MB/s] 62%|\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 715M/1.13G [00:37\u003c00:20, 22.3MB/s] 62%|\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 719M/1.13G [00:37\u003c00:20, 22.2MB/s] 62%|\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 722M/1.13G [00:38\u003c00:21, 21.1MB/s] 63%|\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 726M/1.13G [00:38\u003c00:21, 21.2MB/s] 63%|\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 730M/1.13G [00:38\u003c00:21, 21.5MB/s] 63%|\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 734M/1.13G [00:38\u003c00:20, 21.9MB/s] 64%|\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 738M/1.13G [00:38\u003c00:20, 21.6MB/s] 64%|\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 742M/1.13G [00:39\u003c00:20, 21.7MB/s] 64%|\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 746M/1.13G [00:39\u003c00:19, 21.9MB/s] 65%|\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 750M/1.13G [00:39\u003c00:19, 21.9MB/s] 65%|\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 754M/1.13G [00:39\u003c00:19, 22.4MB/s] 65%|\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 758M/1.13G [00:39\u003c00:19, 22.2MB/s] 65%|\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 760M/1.13G [00:39\u003c00:20, 21.0MB/s] 66%|\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 762M/1.13G [00:40\u003c00:20, 20.6MB/s] 66%|\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 765M/1.13G [00:40\u003c00:17, 23.3MB/s] 66%|\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 769M/1.13G [00:40\u003c00:17, 23.1MB/s] 67%|\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 773M/1.13G [00:40\u003c00:17, 22.7MB/s] 67%|\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 777M/1.13G [00:40\u003c00:17, 22.5MB/s] 67%|\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 781M/1.13G [00:40\u003c00:17, 22.4MB/s] 68%|\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 785M/1.13G [00:41\u003c00:17, 22.3MB/s] 68%|\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 789M/1.13G [00:41\u003c00:17, 22.0MB/s] 68%|\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 792M/1.13G [00:41\u003c00:17, 22.0MB/s] 69%|\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 796M/1.13G [00:41\u003c00:17, 21.8MB/s] 69%|\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 800M/1.13G [00:41\u003c00:17, 21.9MB/s] 69%|\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 804M/1.13G [00:42\u003c00:16, 22.2MB/s] 70%|\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 808M/1.13G [00:42\u003c00:16, 22.2MB/s] 70%|\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 812M/1.13G [00:42\u003c00:16, 22.6MB/s] 70%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 816M/1.13G [00:42\u003c00:16, 22.4MB/s] 71%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 820M/1.13G [00:42\u003c00:15, 22.5MB/s] 71%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 824M/1.13G [00:42\u003c00:15, 22.4MB/s] 71%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 828M/1.13G [00:43\u003c00:15, 22.5MB/s] 72%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 832M/1.13G [00:43\u003c00:15, 22.2MB/s] 72%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 836M/1.13G [00:43\u003c00:15, 22.3MB/s] 72%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 840M/1.13G [00:43\u003c00:15, 22.2MB/s] 73%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 843M/1.13G [00:43\u003c00:14, 22.2MB/s] 73%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 847M/1.13G [00:44\u003c00:14, 22.2MB/s] 73%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 851M/1.13G [00:44\u003c00:14, 22.1MB/s] 74%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 855M/1.13G [00:44\u003c00:14, 22.0MB/s] 74%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 859M/1.13G [00:44\u003c00:14, 22.1MB/s] 74%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 863M/1.13G [00:44\u003c00:14, 22.3MB/s] 75%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 867M/1.13G [00:44\u003c00:13, 22.3MB/s] 75%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 871M/1.13G [00:45\u003c00:13, 22.2MB/s] 75%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 874M/1.13G [00:45\u003c00:13, 22.2MB/s] 76%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 878M/1.13G [00:45\u003c00:13, 21.8MB/s] 76%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 882M/1.13G [00:45\u003c00:13, 22.0MB/s] 76%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 886M/1.13G [00:45\u003c00:13, 21.8MB/s] 77%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 889M/1.13G [00:46\u003c00:14, 20.3MB/s] 77%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 893M/1.13G [00:46\u003c00:12, 21.7MB/s] 77%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 897M/1.13G [00:46\u003c00:12, 21.6MB/s] 78%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 901M/1.13G [00:46\u003c00:12, 21.9MB/s] 78%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 905M/1.13G [00:46\u003c00:12, 21.8MB/s] 78%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 909M/1.13G [00:46\u003c00:11, 22.3MB/s] 79%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 913M/1.13G [00:47\u003c00:11, 22.2MB/s] 79%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 917M/1.13G [00:47\u003c00:11, 22.4MB/s] 79%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 920M/1.13G [00:47\u003c00:11, 22.1MB/s] 80%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 924M/1.13G [00:47\u003c00:11, 22.1MB/s] 80%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 928M/1.13G [00:47\u003c00:11, 22.1MB/s] 80%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 932M/1.13G [00:48\u003c00:10, 22.1MB/s] 81%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 936M/1.13G [00:48\u003c00:10, 22.1MB/s] 81%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 940M/1.13G [00:48\u003c00:10, 22.1MB/s] 81%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 944M/1.13G [00:48\u003c00:10, 22.1MB/s] 82%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 948M/1.13G [00:48\u003c00:10, 22.1MB/s] 82%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 952M/1.13G [00:49\u003c00:09, 22.9MB/s] 82%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 956M/1.13G [00:49\u003c00:09, 23.1MB/s] 83%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 960M/1.13G [00:49\u003c00:09, 22.6MB/s] 83%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 964M/1.13G [00:49\u003c00:09, 22.5MB/s] 83%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 968M/1.13G [00:49\u003c00:09, 22.3MB/s] 84%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 971M/1.13G [00:49\u003c00:08, 22.3MB/s] 84%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 975M/1.13G [00:50\u003c00:08, 22.1MB/s] 84%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 979M/1.13G [00:50\u003c00:08, 22.3MB/s] 85%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 983M/1.13G [00:50\u003c00:08, 22.0MB/s] 85%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 987M/1.13G [00:50\u003c00:08, 22.0MB/s] 85%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 991M/1.13G [00:50\u003c00:08, 22.0MB/s] 86%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 995M/1.13G [00:51\u003c00:07, 22.3MB/s] 86%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 998M/1.13G [00:51\u003c00:07, 22.2MB/s] 86%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 0.98G/1.13G [00:51\u003c00:07, 21.1MB/s] 87%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 0.98G/1.13G [00:51\u003c00:07, 21.4MB/s] 87%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 0.99G/1.13G [00:51\u003c00:07, 20.8MB/s] 87%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 0.99G/1.13G [00:51\u003c00:07, 21.2MB/s] 88%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 0.99G/1.13G [00:52\u003c00:06, 22.5MB/s] 88%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 1.00G/1.13G [00:52\u003c00:06, 22.3MB/s] 88%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 1.00G/1.13G [00:52\u003c00:06, 22.4MB/s] 89%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 1.01G/1.13G [00:52\u003c00:06, 22.4MB/s] 89%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 1.01G/1.13G [00:52\u003c00:06, 22.3MB/s] 89%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 1.01G/1.13G [00:53\u003c00:05, 22.0MB/s] 90%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 1.02G/1.13G [00:53\u003c00:05, 22.0MB/s] 90%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 1.02G/1.13G [00:53\u003c00:05, 22.2MB/s] 90%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 1.02G/1.13G [00:53\u003c00:05, 22.5MB/s] 91%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 1.03G/1.13G [00:53\u003c00:05, 22.5MB/s] 91%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 1.03G/1.13G [00:53\u003c00:04, 22.6MB/s] 91%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f| 1.04G/1.13G [00:54\u003c00:04, 22.7MB/s] 92%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f| 1.04G/1.13G [00:54\u003c00:04, 22.8MB/s] 92%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f| 1.04G/1.13G [00:54\u003c00:04, 22.4MB/s] 92%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f| 1.05G/1.13G [00:54\u003c00:04, 22.3MB/s] 93%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e| 1.05G/1.13G [00:54\u003c00:03, 22.3MB/s] 93%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e| 1.06G/1.13G [00:55\u003c00:03, 22.6MB/s] 93%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e| 1.06G/1.13G [00:55\u003c00:03, 22.6MB/s] 94%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e| 1.06G/1.13G [00:55\u003c00:03, 22.7MB/s] 94%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d| 1.07G/1.13G [00:55\u003c00:03, 22.3MB/s] 94%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d| 1.07G/1.13G [00:55\u003c00:03, 22.0MB/s] 95%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d| 1.07G/1.13G [00:55\u003c00:02, 22.1MB/s] 95%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c| 1.08G/1.13G [00:56\u003c00:02, 22.0MB/s] 95%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c| 1.08G/1.13G [00:56\u003c00:02, 22.1MB/s] 96%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c| 1.09G/1.13G [00:56\u003c00:02, 22.1MB/s] 96%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c| 1.09G/1.13G [00:56\u003c00:02, 22.1MB/s] 96%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b| 1.09G/1.13G [00:56\u003c00:02, 20.0MB/s] 97%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b| 1.10G/1.13G [00:57\u003c00:02, 20.4MB/s] 97%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b| 1.10G/1.13G [00:57\u003c00:01, 21.1MB/s] 97%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b| 1.10G/1.13G [00:57\u003c00:01, 21.4MB/s] 98%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a| 1.11G/1.13G [00:57\u003c00:01, 21.4MB/s] 98%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a| 1.11G/1.13G [00:58\u003c00:02, 12.7MB/s] 98%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a| 1.11G/1.13G [00:58\u003c00:01, 13.8MB/s] 98%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a| 1.12G/1.13G [00:58\u003c00:01, 15.7MB/s] 99%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a| 1.12G/1.13G [00:58\u003c00:00, 17.3MB/s] 99%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589| 1.12G/1.13G [00:58\u003c00:00, 18.5MB/s] 99%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589| 1.13G/1.13G [00:59\u003c00:00, 19.2MB/s] 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589| 1.13G/1.13G [00:59\u003c00:00, 20.0MB/s] 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589| 1.13G/1.13G [00:59\u003c00:00, 20.4MB/s] 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 1.13G/1.13G [00:59\u003c00:00, 20.5MB/s] \uc774\uc81c \uc77c\ubc18\uc801\uc778 \ud559\uc2b5 \ub8e8\ud504\ub97c \uc815\uc758\ud574\ubd05\uc2dc\ub2e4. \uc2e4\uc81c \ud559\uc2b5 \uc2dc\uc5d0\ub294 \uc9c4\uc9dc \uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud574\uc57c \ud558\uc9c0\ub9cc, \uc774 \ud29c\ud1a0\ub9ac\uc5bc\uc5d0\uc11c\ub294 \uac00\uc9dc \uc785\ub825 \ub370\uc774\ud130\ub97c \uc0ac\uc6a9\ud558\uba70 \uc2e4\uc81c \ub370\uc774\ud130\ub97c \uc77d\uc5b4\ub4e4\uc774\ub294 \uac83\uc5d0 \ub300\ud574\uc11c\ub294 \uc2e0\uacbd \uc4f0\uc9c0 \uc54a\uc744 \uac83\uc785\ub2c8\ub2e4. IMAGE_SIZE = 224 def train(model, optimizer): # \uac00\uc9dc \uc774\ubbf8\uc9c0 \uc785\ub825\uac12 \uc0dd\uc131: tensor\uc758 \ud615\ud0dc\ub294 batch_size, channels, height, width fake_image = torch.rand(1, 3, IMAGE_SIZE, IMAGE_SIZE).cuda() # forward\uc640 backward \ud638\ucd9c loss = model.forward(fake_image) loss.sum().backward() # \uc635\ud2f0\ub9c8\uc774\uc800 \uc5c5\ub370\uc774\ud2b8 optimizer.step() optimizer.zero_grad() \ud559\uc2b5 \uc911\uc758 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9# \uc774\uc81c \uba54\ubaa8\ub9ac \uc2a4\ub0c5\uc0f7\uc744 \ud655\uc778\ud558\ub824\uace0 \ud558\ubbc0\ub85c, \uc774\ub97c \uc801\uc808\ud788 \ubd84\uc11d\ud560 \uc900\ube44\ub97c \ud574\uc57c \ud569\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c \ud559\uc2b5 \uba54\ubaa8\ub9ac\ub294 \ub2e4\uc74c\uc73c\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4: \ubaa8\ub378 \ub9e4\uac1c\ubcc0\uc218 (\ud06c\uae30 P) backward pass\ub97c \uc704\ud574 \uc800\uc7a5\ub41c \ud65c\uc131\ud654 \uac12(activations) (\ud06c\uae30 A) \ubcc0\ud654\ub3c4, \ubaa8\ub378 \ub9e4\uac1c\ubcc0\uc218\uc640 \uac19\uc740 \ud06c\uae30\uc774\ubbc0\ub85c \ud06c\uae30 G = P. \uc635\ud2f0\ub9c8\uc774\uc800 \uc0c1\ud0dc, \ub9e4\uac1c\ubcc0\uc218 \ud06c\uae30\uc5d0 \ube44\ub840\ud569\ub2c8\ub2e4. \uc608\uc2dc\uc758 \uacbd\uc6b0, Adam\uc758 \uc0c1\ud0dc\ub294 \ubaa8\ub378 \ub9e4\uac1c\ubcc0\uc218\uc758 2\ubc30\uac00 \ud544\uc694\ud558\ubbc0\ub85c \ud06c\uae30 O = 2P. \uc911\uac04 \ub2e8\uacc4(Intermediate) tensor, \uacc4\uc0b0 \ub3c4\uc911 \ud560\ub2f9\ub429\ub2c8\ub2e4. \ubcf4\ud1b5 \ud06c\uae30\uac00 \uc791\uace0 \uc77c\uc2dc\uc801\uc774\ubbc0\ub85c \uc9c0\uae08\uc740 \uc2e0\uacbd \uc4f0\uc9c0 \uc54a\uaca0\uc2b5\ub2c8\ub2e4. \uba54\ubaa8\ub9ac \uc2a4\ub0c5\uc0f7 \ucea1\ucc98 \ubc0f \uc2dc\uac01\ud654# \uc774\uc81c \uba54\ubaa8\ub9ac \uc2a4\ub0c5\uc0f7\uc744 \uac00\uc838\uc640 \ubd05\uc2dc\ub2e4! \ucf54\ub4dc\uac00 \uc2e4\ud589\ub418\ub294 \ub3d9\uc548, CUDA \uba54\ubaa8\ub9ac \ud0c0\uc784\ub77c\uc778\uc774 \uc5b4\ub5a4 \ubaa8\uc2b5\uc77c\uc9c0 \ud55c \ubc88 \uc608\uc0c1\ud574 \ubcf4\uc138\uc694. # CUDA\uc5d0 \uba54\ubaa8\ub9ac \ud560\ub2f9 \uae30\ub85d\uc744 \uc2dc\uc791\ud558\ub3c4\ub85d \uc9c0\uc2dc torch.cuda.memory._record_memory_history(enabled=\u0027all\u0027) # \ud559\uc2b5 3\ud68c \uc2e4\uc2dc for _ in range(3): train(model, optimizer) # \uba54\ubaa8\ub9ac \ud560\ub2f9 \uc2a4\ub0c5\uc0f7\uc744 \uc800\uc7a5 s = torch.cuda.memory._snapshot() with open(f\"snapshot.pickle\", \"wb\") as f: dump(s, f) # CUDA\uc5d0 \uba54\ubaa8\ub9ac \ud560\ub2f9 \uae30\ub85d\uc744 \uc911\uc9c0\ud558\ub3c4\ub85d \uc9c0\uc2dc torch.cuda.memory._record_memory_history(enabled=None) \uc774\uc81c CUDA \uba54\ubaa8\ub9ac \uc2dc\uac01\ud654 \ub3c4\uad6c(CUDA Memory Visualizer)\uc5d0\uc11c \uc2a4\ub0c5\uc0f7\uc744 \uc5f4\uc5b4\ubcf4\uc138\uc694. https://pytorch.org/memory_viz \ub85c \ub4e4\uc5b4\uac00\uc11c snapshot.pickle \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \uc564 \ub4dc\ub86d\ud558\uc5ec \uc5c5\ub85c\ub4dc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uba54\ubaa8\ub9ac \ud0c0\uc784\ub77c\uc778\uc774 \uc608\uc0c1\uacfc \uc77c\uce58\ud558\ub098\uc694? \ubaa8\ub378 \ub9e4\uac1c\ubcc0\uc218\ub294 \uc774\ubbf8 \ud559\uc2b5 \ub8e8\ud504 \uc774\uc804\uc5d0 \uba54\ubaa8\ub9ac\uc5d0 \ub85c\ub4dc\ub418\uc5c8\uc73c\ubbc0\ub85c, \ucc98\uc74c\ubd80\ud130 \uac00\uc911\uce58(weights)\uc5d0 \ud560\ub2f9\ub41c \uba54\ubaa8\ub9ac \ub369\uc5b4\ub9ac\uac00 \ubcf4\uc785\ub2c8\ub2e4. forward pass\ub97c \uc2dc\uc791\ud558\uba74, \uba54\ubaa8\ub9ac\ub294 \ud65c\uc131\ud654 \uac12\uc744 \uc704\ud574 \uc810\ucc28 \ud560\ub2f9\ub429\ub2c8\ub2e4. \uc774 \ud65c\uc131\ud654 \uac12\uc740 backward pass\uc5d0\uc11c \ubcc0\ud654\ub3c4\ub97c \uacc4\uc0b0\ud558\uae30 \uc704\ud574 \uc800\uc7a5\ud558\ub294 tensor\uc785\ub2c8\ub2e4. backward pass\ub97c \uc2dc\uc791\ud558\uba74, \ud65c\uc131\ud654 \uac12\uc774 \uc810\ucc28 \ud574\uc81c\ub418\uba74\uc11c \ubcc0\ud654\ub3c4\uac00 \ucc28\uc9c0\ud558\ub294 \uba54\ubaa8\ub9ac\uac00 \uc313\uc774\uae30 \uc2dc\uc791\ud569\ub2c8\ub2e4. \ub9c8\uc9c0\ub9c9\uc73c\ub85c \uc635\ud2f0\ub9c8\uc774\uc800\uac00 \uc791\ub3d9\ud558\uba74, \uc635\ud2f0\ub9c8\uc774\uc800\uc758 \uc0c1\ud0dc\ub294 \uc9c0\uc5f0(lazily) \ucd08\uae30\ud654\ub418\ubbc0\ub85c, \uccab \ubc88\uc9f8 \ud559\uc2b5 \ub8e8\ud504\uc758 \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4 \ub3d9\uc548\ub9cc \uc635\ud2f0\ub9c8\uc774\uc800 \uc0c1\ud0dc \uba54\ubaa8\ub9ac\uac00 \uc810\ucc28 \uc99d\uac00\ud558\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ud6c4\uc758 \ub8e8\ud504\uc5d0\uc11c\ub294, \uc635\ud2f0\ub9c8\uc774\uc800 \uba54\ubaa8\ub9ac\uac00 \uadf8\ub300\ub85c \uc720\uc9c0\ub418\uace0, \uc81c\uc790\ub9ac\uc5d0\uc11c \uc5c5\ub370\uc774\ud2b8\ub429\ub2c8\ub2e4. \ubcc0\ud654\ub3c4\uac00 \ucc28\uc9c0\ud558\ub294 \uba54\ubaa8\ub9ac\ub294 \ub9e4\ubc88 \ud559\uc2b5 \ub8e8\ud504\uac00 \ub05d\ub0a0 \ub54c\uc5d0 \ub9de\ucdb0 zero_grad \uac00 \ud638\ucd9c\ub418\uba74 \ud574\uc81c\ub429\ub2c8\ub2e4. \uc774 \ud559\uc2b5 \ub8e8\ud504\uc5d0\uc11c \uba54\ubaa8\ub9ac \ubcd1\ubaa9 \ud604\uc0c1\uc774 \ubc1c\uc0dd\ud558\ub294 \uc9c0\uc810\uc740 \uc5b4\ub514\uc77c\uae4c\uc694? \uc989, \uba54\ubaa8\ub9ac \uc0ac\uc6a9\uc774 \uac00\uc7a5 \ub192\uc740 \uc9c0\uc810\uc740 \uc5b4\ub514\uc77c\uae4c\uc694? \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc774 \uac00\uc7a5 \ub192\uc740 \uc9c0\uc810\uc740 \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\uc785\ub2c8\ub2e4! \uc774\ub54c\uc758 \uba54\ubaa8\ub9ac\ub97c \ubcf4\uba74 \uc608\uc0c1\ub300\ub85c ~1.2GB \uc758 \ub9e4\uac1c\ubcc0\uc218, ~1.2GB\uc758 \ubcc0\ud654\ub3c4, \uadf8\ub9ac\uace0 ~2.4GB=2*1.2GB \uc758 \uc635\ud2f0\ub9c8\uc774\uc800 \uc0c1\ud0dc\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. \ub9c8\uc9c0\ub9c9 ~1.2GB\ub294 Adam \uc635\ud2f0\ub9c8\uc774\uc800\uac00 \uc911\uac04 \ub2e8\uacc4\uc5d0 \ud544\uc694\ub85c \ud558\ub294 \uba54\ubaa8\ub9ac\ub85c, \ud569\uccd0\uc11c \ucd1d ~6GB\uc5d0 \ub2ec\ud569\ub2c8\ub2e4. \uc0ac\uc2e4, Adam(model.parameters(), foreach=False) \ub85c \uc124\uc815\ud558\uba74 \uc635\ud2f0\ub9c8\uc774\uc800 \uc911\uac04 \uba54\ubaa8\ub9ac\uc778 \ub9c8\uc9c0\ub9c9 1.2GB\ub97c \uc81c\uac70\ud560 \uc218 \uc788\ub294\ub370, \uc774\ub294 \uba54\ubaa8\ub9ac \ub300\uc2e0 \uc2e4\ud589 \uc2dc\uac04\uc744 \ud76c\uc0dd\ud558\ub294 \ubc29\uc2dd\uc785\ub2c8\ub2e4. \ub9cc\uc57d \uc774 foreach \ucd5c\uc801\ud654\ub9cc\uc73c\ub85c\ub3c4 \ucda9\ubd84\ud788 \ud544\uc694\ud55c\ub9cc\ud07c \uba54\ubaa8\ub9ac\uac00 \uc808\uc57d\ub418\uc5c8\ub2e4\uba74 \uc798\ub41c \uc77c\uc774\uc9c0\ub9cc, \ub354 \ub098\uc740 \ubc29\ubc95\uc5d0 \ub300\ud574 \uc54c\uace0 \uc2f6\ub2e4\uba74 \uc774 \ud29c\ud1a0\ub9ac\uc5bc\uc744 \uacc4\uc18d \uc77d\uc5b4\ubcf4\uc138\uc694! \uc774\uc81c \uace7 \uc18c\uac1c\ud560 \ubc29\ubc95\uc744 \uc0ac\uc6a9\ud55c\ub2e4\uba74, ~1.2GB\uc758 \ubcc0\ud654\ub3c4 \uba54\ubaa8\ub9ac \uc640 \uc635\ud2f0\ub9c8\uc774\uc800 \uc911\uac04 \ub2e8\uacc4 \uba54\ubaa8\ub9ac \uac00 \ud544\uc694 \uc5c6\uac8c \ub418\uc5b4 \ucd5c\ub300 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc744 \ub0ae\ucd9c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub807\ub2e4\uba74, \uc0c8\ub85c\uc6b4 \ucd5c\ub300 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc740 \uc5bc\ub9c8\uac00 \ub420\uae4c\uc694? \uc815\ub2f5\uc740 \ub2e4\uc74c \uc2a4\ub0c5\uc0f7\uc5d0\uc11c \uacf5\uac1c\ub429\ub2c8\ub2e4. \uc8fc\uc758 \uc0ac\ud56d: \uc774 \ubc29\ubc95\uc740 \ubaa8\ub4e0 \uacbd\uc6b0\uc5d0 \uc801\ud569\ud55c \uac83\uc740 \uc544\ub2d8# \uc7a0\uc2dc \uc9c4\uc815\ud558\uace0, \uba3c\uc800 \uc774 \ubc29\ubc95\uc774 \ub2f9\uc2e0 \uc758 \uc0ac\uc6a9 \uc0ac\ub840\uc5d0 \uc801\ud569\ud55c\uc9c0 \uace0\ub824\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774 \ubc29\ubc95\uc740 \uacb0\ucf54 \ub9cc\ub2a5 \ud574\uacb0\ucc45\uc774 \uc544\ub2d9\ub2c8\ub2e4! \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\ub97c backward \uacfc\uc815\uc5d0 \ud569\uce58\ub294 \uc774 \ubc29\ubc95\uc740 \ubcc0\ud654\ub3c4 \uba54\ubaa8\ub9ac\uc758 \uac10\uc18c\ub9cc\uc744 \ubaa9\ud45c\ub85c \ud569\ub2c8\ub2e4 (\uadf8\ub9ac\uace0 \ubd80\uc218\uc801\uc73c\ub85c \uc635\ud2f0\ub9c8\uc774\uc800 \uc911\uac04 \ub2e8\uacc4 \uba54\ubaa8\ub9ac\ub3c4 \uc904\uc785\ub2c8\ub2e4). \ub530\ub77c\uc11c \ubcc0\ud654\ub3c4\uac00 \ucc28\uc9c0\ud558\ub294 \uba54\ubaa8\ub9ac\uac00 \ud074\uc218\ub85d, \uba54\ubaa8\ub9ac \uc808\uc57d \ud6a8\uacfc\uac00 \ub354\uc6b1 \ucee4\uc9d1\ub2c8\ub2e4. \uc704\uc758 \uc608\uc2dc\uc5d0\uc11c \ubcc0\ud654\ub3c4\ub294 \uba54\ubaa8\ub9ac \ucd1d\ub7c9\uc758 20%\ub97c \ucc28\uc9c0\ud558\ub294\ub370, \uc774\ub294 \uaf64\ub098 \ud070 \ube44\uc728\uc774\uc8e0! \uadf8\ub7ec\ub098 \ub54c\uc5d0 \ub530\ub77c \uc774\ub7ec\ud55c \uc0c1\ud669\uc5d0 \ud574\ub2f9\ud558\uc9c0 \uc54a\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, \uc774\ubbf8 \uac00\uc911\uce58\uac00 \ub9e4\uc6b0 \uc791\ub2e4\uba74 (LoRa \uc801\uc6a9 \ub4f1\uc758 \uc774\uc720\ub85c), \ubcc0\ud654\ub3c4\uac00 \ud559\uc2b5 \ub8e8\ud504\uc5d0\uc11c \uacf5\uac04\uc744 \ub9ce\uc774 \ucc28\uc9c0\ud558\uc9c0 \uc54a\uc744 \uac83\uc774\uace0, \uadf8\ub807\ub2e4\uba74 \uc774 \ubc29\ubc95\uc758 \uc774\uc810\uc774 \uadf8\ub2e4\uc9c0 \ud06c\uc9c0 \uc54a\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uacbd\uc6b0\uc5d0\ub294 \uba3c\uc800 \ud65c\uc131\ud654 \uac12 \uccb4\ud06c\ud3ec\uc778\ud305, \ubd84\uc0b0 \ud559\uc2b5, \uc591\uc790\ud654, \ubc30\uce58 \ud06c\uae30 \ucd95\uc18c\uc640 \uac19\uc740 \ub2e4\ub978 \uae30\uc220\uc744 \uc2dc\ub3c4\ud574 \ubcf4\uc138\uc694. \uadf8\ub7f0 \ub2e4\uc74c, \ubcc0\ud654\ub3c4\uac00 \ub2e4\uc2dc \ubcd1\ubaa9\uc758 \uc77c\ubd80\uac00 \ub420 \ub54c \uc774 \ud29c\ud1a0\ub9ac\uc5bc\ub85c \ub3cc\uc544\uc624\uc138\uc694! \uc544\uc9c1 \uc5ec\uae30\uc5d0 \uacc4\uc2e0\uac00\uc694? \uc88b\uc2b5\ub2c8\ub2e4, \uc774\uc81c Tensor\uc758 \uc0c8\ub85c\uc6b4 register_post_accumulate_grad_hook(hook) API\ub97c \uc18c\uac1c\ud558\uaca0\uc2b5\ub2c8\ub2e4. Tensor.register_post_accumulate_grad_hook(hook) API\uc640 \uc6b0\ub9ac\uac00 \uc0ac\uc6a9\ud560 \ubc29\ubc95# \uc774 \ubc29\ubc95\uc740 backward() \ub3d9\uc548 \ubcc0\ud654\ub3c4\ub97c \uc800\uc7a5\ud558\uc9c0 \uc54a\uc544\ub3c4 \ub41c\ub2e4\ub294 \uc810\uc5d0 \uc758\uc874\ud569\ub2c8\ub2e4. \ub300\uc2e0, \uae30\uc6b8\uae30\uac00 \ub204\uc801\ub418\uba74 \uc989\uc2dc \ud574\ub2f9 \ub9e4\uac1c\ubcc0\uc218\uc5d0 \ub300\ud574 \uc635\ud2f0\ub9c8\uc774\uc800\ub97c \uc801\uc6a9\ud558\uace0, \ud574\ub2f9 \ubcc0\ud654\ub3c4\ub97c \uc644\uc804\ud788 \uc81c\uac70\ud569\ub2c8\ub2e4! \uc774\ub807\uac8c \ud558\uba74 \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\ub97c \uc704\ud574 \ud070 \ubcc0\ud654\ub3c4 \ubc84\ud37c\ub97c \uc720\uc9c0\ud560 \ud544\uc694\uac00 \uc5c6\uc5b4\uc9d1\ub2c8\ub2e4. \uadf8\ub807\ub2e4\uba74 \uc635\ud2f0\ub9c8\uc774\uc800\ub97c \ub354 \uc989\uc2dc(eagerly) \uc801\uc6a9\ud558\ub294 \ub3d9\uc791\uc744 \uc5b4\ub5bb\uac8c \ud558\uba74 \ud65c\uc131\ud654\ud560 \uc218 \uc788\uc744\uae4c\uc694? 2.1 \ubc84\uc804\uc5d0\uc11c \uc0c8\ub85c \ucd94\uac00\ub41c API\uc778 torch.Tensor.register_post_accumulate_grad_hook() \uc744 \uc0ac\uc6a9\ud558\uba74, Tensor\uc758 .grad \ud544\ub4dc(field)\uac00 \ub204\uc801\ub41c \ud6c4\uc5d0 \ud6c5(hook)\uc744 \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc6b0\ub9ac\ub294 \uc774 \ud6c5\uc5d0 \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\ub97c \ucea1\uc290\ud654(encapsulate)\ud560 \uac83\uc785\ub2c8\ub2e4. \uc5b4\ub5bb\uac8c\uc694? \uc774 \ubaa8\ub4e0 \uac83\uc744 \ub2e8 10\uc904\uc758 \ucf54\ub4dc\ub85c \ud1b5\ud569\ud558\ub294 \ubc29\ubc95# \ucd08\ubc18\uc5d0 \uc0ac\uc6a9\ud588\ub358 \ubaa8\ub378\uacfc \uc635\ud2f0\ub9c8\uc774\uc800 \uc124\uc815\uc744 \uae30\uc5b5\ud558\uc2dc\ub098\uc694? \ucf54\ub4dc \uc7ac\uc2e4\ud589\uc5d0 \ub9ac\uc18c\uc2a4\ub97c \ub0ad\ube44\ud558\uc9c0 \uc54a\ub3c4\ub85d \uc544\ub798\uc5d0 \uc8fc\uc11d\uc73c\ub85c \ub0a8\uaca8\ub450\uaca0\uc2b5\ub2c8\ub2e4. model = models.vit_l_16(weights=\u0027DEFAULT\u0027).cuda() optimizer = torch.optim.Adam(model.parameters()) # *\ub2e8\uc77c* \uc635\ud2f0\ub9c8\uc774\uc800 \ub300\uc2e0, \uac01 \ub9e4\uac1c\ubcc0\uc218\ub9c8\ub2e4 \ud558\ub098\uc529 \uc635\ud2f0\ub9c8\uc774\uc800\ub97c \ub9cc\ub4e4\uace0 ``\ub515\uc154\ub108\ub9ac`` # \ud558\ub098\uc5d0 \uc800\uc7a5\ud558\uc5ec \ud6c5\uc5d0\uc11c \ucc38\uc870\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4. optimizer_dict = {p: torch.optim.Adam([p], foreach=False) for p in model.parameters()} # \uc635\ud2f0\ub9c8\uc774\uc800\uc758 ``step()`` \ubc0f ``zero_grad()`` \ub97c \ud638\ucd9c\ud560 \ud6c5\uc744 \uc815\uc758\ud569\ub2c8\ub2e4. def optimizer_hook(parameter) -\u003e None: optimizer_dict[parameter].step() optimizer_dict[parameter].zero_grad() # \ubaa8\ub4e0 \ub9e4\uac1c\ubcc0\uc218\uc5d0 \ud6c5\uc744 \ub4f1\ub85d\ud569\ub2c8\ub2e4. for p in model.parameters(): p.register_post_accumulate_grad_hook(optimizer_hook) # \uc774\uc804\uc758 ``train()`` \ud568\uc218 \uae30\uc5b5\ud558\uc2dc\ub098\uc694? \uc635\ud2f0\ub9c8\uc774\uc800\uac00 backward\uc5d0 \ud569\uccd0\uc84c\uc73c\ubbc0\ub85c, # \uc635\ud2f0\ub9c8\uc774\uc800\uc758 step \ubc0f zero_grad \ud638\ucd9c\uc744 \uc81c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. def train(model): # \uac00\uc9dc \uc774\ubbf8\uc9c0 \uc785\ub825\uac12 \uc0dd\uc131: tensor\uc758 \ud615\ud0dc\ub294 batch_size, channels, height, width fake_image = torch.rand(1, 3, IMAGE_SIZE, IMAGE_SIZE).cuda() # forward\uc640 backward \ud638\ucd9c loss = model.forward(fake_image) loss.sum().backward() # \uc635\ud2f0\ub9c8\uc774\uc800 \uc5c5\ub370\uc774\ud2b8 --\u003e \uc774\uc81c \ud544\uc694 \uc5c6\uc2b5\ub2c8\ub2e4! # optimizer.step() # optimizer.zero_grad() \uc0d8\ud50c \ubaa8\ub378\uc5d0\uc11c\ub294 \uc57d 10\uc904\uc758 \ucf54\ub4dc \ubcc0\uacbd\uc73c\ub85c \ub05d\ub0ac\uc2b5\ub2c8\ub2e4. \uae54\ub054\ud558\ub124\uc694. \ud558\uc9c0\ub9cc \uc2e4\uc81c \ubaa8\ub378\uc5d0\uc11c\ub294 \uc635\ud2f0\ub9c8\uc774\uc800\ub97c \uc635\ud2f0\ub9c8\uc774\uc800 \ub515\uc154\ub108\ub9ac\ub85c \uad50\uccb4\ud558\ub294 \uac83\uc774 \uaf64\ub098 \uac70\uc2ac\ub9ac\ub294 \ubcc0\uacbd\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud2b9\ud788 LRScheduler \ub97c \uc0ac\uc6a9\ud558\uac70\ub098 \ud559\uc2b5 \uc5d0\ud3ed \ub3d9\uc548 \uc635\ud2f0\ub9c8\uc774\uc800 \uad6c\uc131\uc744 \uc870\uc791\ud558\ub294 \uacbd\uc6b0\uc5d0\ub294 \ub354\uc6b1 \uadf8\ub807\uc2b5\ub2c8\ub2e4. \uadf8\ub7ec\ud55c \uc0c1\ud669\uc5d0\uc11c \uc774 API\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \ub354 \ubcf5\uc7a1\ud560 \uac83\uc774\uace0, \ub354 \ub9ce\uc740 \uad6c\uc131 \uc694\uc18c\ub97c \uc804\uc5ed(global) \uc0c1\ud0dc\ub85c \uc774\ub3d9\uc2dc\ucf1c\uc57c \ud560 \uc218\ub3c4 \uc788\uc9c0\ub9cc, \ubd88\uac00\ub2a5\ud558\uc9c0\ub294 \uc54a\uc744 \uac83\uc785\ub2c8\ub2e4. \uadf8\ub807\uae34 \ud558\uc9c0\ub9cc, \uc870\ub9cc\uac04 PyTorch\uac00 \uc774 API\ub97c LRScheduler\ub098 \uae30\uc874\uc758 \ub2e4\ub978 \uae30\ub2a5\ub4e4\uacfc \ub354 \uc27d\uac8c \ud1b5\ud569\ud560 \uc218 \uc788\ub3c4\ub85d \uc774 API\ub97c \uac1c\uc120\ud558\uae38 \ubc14\ub77c \ubd05\ub2c8\ub2e4. \ub2e4\uc2dc \ub3cc\uc544\uc640\uc11c, \uc774 \ubc29\ubc95\uc774 \uc368\ubcfc \ub9cc\ud55c \uac00\uce58\uac00 \uc788\ub2e4\ub294 \uc124\ub4dd\uc744 \uc774\uc5b4 \ub098\uac00 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \uc6b0\ub9ac\uc758 \uce5c\uad6c, \uba54\ubaa8\ub9ac \uc2a4\ub0c5\uc0f7\uc744 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. # \uc774\uc804\uc758 \uc635\ud2f0\ub9c8\uc774\uc800 \uba54\ubaa8\ub9ac\ub97c \uc0ad\uc81c\ud558\uc5ec \ub2e4\uc74c \uba54\ubaa8\ub9ac \uc2a4\ub0c5\uc0f7\uc744 \uc704\ud55c \uae68\ub057\ud55c \uc0c1\ud0dc\ub97c # \ub9cc\ub4ed\ub2c8\ub2e4. del optimizer # CUDA\uc5d0 \uba54\ubaa8\ub9ac \ud560\ub2f9 \uae30\ub85d\uc744 \uc2dc\uc791\ud558\ub3c4\ub85d \uc9c0\uc2dc torch.cuda.memory._record_memory_history(enabled=\u0027all\u0027) # \ud559\uc2b5 3\ud68c \uc2e4\uc2dc. \uc774\uc81c \ub354 \uc774\uc0c1 train() \ud568\uc218\uc5d0 \uc635\ud2f0\ub9c8\uc774\uc800\ub97c \uc804\ub2ec\ud558\uc9c0 \uc54a\ub294\ub2e4\ub294 \uc810\uc5d0 \uc720\uc758\ud558\uc138\uc694. for _ in range(3): train(model) # \uba54\ubaa8\ub9ac \ud560\ub2f9 \uc2a4\ub0c5\uc0f7\uc744 \uc800\uc7a5 s = torch.cuda.memory._snapshot() with open(f\"snapshot-opt-in-bwd.pickle\", \"wb\") as f: dump(s, f) # CUDA\uc5d0 \uba54\ubaa8\ub9ac \ud560\ub2f9 \uae30\ub85d\uc744 \uc911\uc9c0\ud558\ub3c4\ub85d \uc9c0\uc2dc torch.cuda.memory._record_memory_history(enabled=None) \uc88b\uc544\uc694, CUDA Memory Visualizer\uc5d0 \uc2a4\ub0c5\uc0f7\uc744 \ub4dc\ub798\uadf8 \uc564 \ub4dc\ub86d\ud574 \ubd05\uc2dc\ub2e4. \uba87 \uac00\uc9c0 \uc8fc\uc694 \uad00\ucc30 \uc0ac\ud56d: \ub354 \uc774\uc0c1 \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4! \ub9de\uc544\uc694\u2026 backward \uacfc\uc815\uc5d0 \ud569\uccd0\uc84c\uc8e0. \ub9c8\ucc2c\uac00\uc9c0\ub85c, backward \uacfc\uc815\uc774 \ub354 \uae38\uc5b4\uc9c0\uace0 \uc911\uac04 \ub2e8\uacc4\ub97c \uc704\ud55c \uc784\uc2dc \uba54\ubaa8\ub9ac \ud560\ub2f9\uc774 \ub354 \ub9ce\uc544\uc84c\uc2b5\ub2c8\ub2e4. \uc774\ub294 \uc608\uc0c1\ub41c \uacb0\uacfc\uc778\ub370, \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\uac00 \uc911\uac04 \ub2e8\uacc4\ub97c \ud544\uc694\ub85c \ud558\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uac00\uc7a5 \uc911\uc694\ud55c \uc810! \ucd5c\ub300 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc774 \ub0ae\uc544\uc84c\uc2b5\ub2c8\ub2e4! \uc774\uc81c ~4GB \uc815\ub3c4\uc785\ub2c8\ub2e4 (\uc608\uc0c1\ud558\uc168\ub358 \uc218\uce58\uc640 \uc5bc\ucd94 \ube44\uc2b7\ud558\uae38 \ubc14\ub78d\ub2c8\ub2e4). \ub354 \uc774\uc0c1 \ubcc0\ud654\ub3c4\ub97c \uc704\ud574 \ud560\ub2f9\ub41c \ud070 \uba54\ubaa8\ub9ac \ub369\uc5b4\ub9ac\uac00 \uc5c6\ub2e4\ub294 \uc810\uc5d0 \uc8fc\ubaa9\ud558\uc138\uc694. \uc774\uc5d0 \ub530\ub77c \uc774\uc804\uacfc \ube44\uad50\ud574 \ubcf4\uc558\uc744 \ub54c ~1.2GB \uc758 \uba54\ubaa8\ub9ac \uc808\uc57d\uc774 \uc774\ub8e8\uc5b4\uc84c\uc2b5\ub2c8\ub2e4. \ub300\uc2e0, \ubcc0\ud654\ub3c4\uac00 \uacc4\uc0b0\ub418\uc790\ub9c8\uc790 \ub9e4\uc6b0 \ube60\ub974\uac8c \ud574\uc81c\ub418\uc5c8\ub294\ub370, \uc774\ub294 \uac00\ub2a5\ud55c \ud55c \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\ub97c \uc55e\ub2f9\uacbc\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uc57c\ud638! \ucc38\uace0\ub85c, \ub098\uba38\uc9c0 ~1.2GB \uc758 \uba54\ubaa8\ub9ac \uc808\uc57d\uc740 \uc635\ud2f0\ub9c8\uc774\uc800\ub97c \ub9e4\uac1c\ubcc0\uc218\ubcc4 \uc635\ud2f0\ub9c8\uc774\uc800\ub85c \ub098\ub204\uba74\uc11c \uc911\uac04 \ub2e8\uacc4\uc758 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc774 \uc904\uc5b4\ub4e0 \ub355\ubd84\uc785\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc774\uac83\uc740 \uae30\uc6b8\uae30 \uba54\ubaa8\ub9ac \uc808\uc57d\ubcf4\ub2e4\ub294 \ub35c \uc911\uc694\ud55c \ubd80\ubd84\uc778\ub370, \uc65c\ub0d0\ud558\uba74 \uc911\uac04 \ub2e8\uacc4\uc758 \uba54\ubaa8\ub9ac \uc808\uc57d\uc740 \uc774 \uae30\uc220 \uc5c6\uc774\ub3c4 foreach=False \uc635\uc158\uc744 \uc218\uc815\ud574 \uc8fc\ub294 \uac83\ub9cc\uc73c\ub85c \ub2ec\uc131\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uc774\ub7f0 \uc758\ubb38\uc774 \uc0dd\uae38 \uc218 \uc788\uc2b5\ub2c8\ub2e4: 2.4GB\uc758 \uba54\ubaa8\ub9ac\uac00 \uc808\uc57d\ub418\uc5c8\ub2e4\uba74, \uc65c \ucd5c\ub300 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc774 6GB - 2.4GB = 3.6GB\uac00 \uc544\ub2cc\uac00\uc694? \uc544, \uadf8\uac74 \ucd5c\ub300 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc758 \uc2dc\uc810\uc774 \ubc14\ub00c\uc5c8\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4! \ucd5c\ub300 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc740 \uc774\uc81c backward \uacfc\uc815\uc758 \uc2dc\uc791 \ubd80\ubd84\uc73c\ub85c \uc774\ub3d9\ud588\uc2b5\ub2c8\ub2e4. \uc774\uc81c\ub294 \uc774 \uc2dc\uc810\uc5d0 \uba54\ubaa8\ub9ac\uc5d0 \ud65c\uc131\ud654 \uac12\uc774 \ub0a8\uc544\uc788\uc73c\uba70, \uc774\uc804\uc5d0\ub294 \uc635\ud2f0\ub9c8\uc774\uc800 \ub2e8\uacc4\uc5d0\uc11c \ud65c\uc131\ud654 \uac12\uc774 \ud574\uc81c\ub41c \ud6c4 \ucd5c\ub300 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc774 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4. ~4.0GB\uc640 ~3.6GB \uac04\uc758 ~0.4GB\uc758 \ucc28\uc774\ub294 \ubc14\ub85c \uc774 \ud65c\uc131\ud654 \uac12\uc758 \uba54\ubaa8\ub9ac \ub54c\ubb38\uc785\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc774 \uae30\uc220\uc744 \ud65c\uc131\ud654 \uac12 \uccb4\ud06c\ud3ec\uc778\ud305\uacfc \ud568\uaed8 \uc0ac\uc6a9\ud558\uba74 \ub354 \ud070 \uba54\ubaa8\ub9ac \uc808\uc57d\uc744 \uc774\ub8f0 \uc218 \uc788\uc744 \uac83\uc785\ub2c8\ub2e4. \uacb0\ub860# \uc774\ubc88 \ud29c\ud1a0\ub9ac\uc5bc\uc5d0\uc11c\ub294 \uc0c8\ub85c\uc6b4 Tensor.register_post_accumulate_grad_hook() API\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc635\ud2f0\ub9c8\uc774\uc800\ub97c backward \ub2e8\uacc4\uc5d0 \ud569\uce58\ub294 \uba54\ubaa8\ub9ac \uc808\uc57d \uae30\uc220\uacfc \uc774\ub97c \uc5b8\uc81c \uc801\uc6a9\ud574\uc57c \ud558\ub294\uc9c0(\ubcc0\ud654\ub3c4 \uba54\ubaa8\ub9ac \uc591\uc774 \uc0c1\ub2f9\ud55c \uacbd\uc6b0)\uc5d0 \ub300\ud574 \ubc30\uc6e0\uc2b5\ub2c8\ub2e4. \ub610\ud55c \uba54\ubaa8\ub9ac \ucd5c\uc801\ud654\uc5d0 \uc77c\ubc18\uc801\uc73c\ub85c \uc720\uc6a9\ud55c \uba54\ubaa8\ub9ac \uc2a4\ub0c5\uc0f7\uc5d0 \ub300\ud574\uc11c\ub3c4 \ud559\uc2b5\ud588\uc2b5\ub2c8\ub2e4. Total running time of the script: (1 minutes 44.579 seconds) Download Jupyter notebook: optimizer_step_in_backward_tutorial.ipynb Download Python source code: optimizer_step_in_backward_tutorial.py Download zipped: optimizer_step_in_backward_tutorial.zip",
       "author": {
         "@type": "Organization",
         "name": "PyTorch Contributors",
         "url": "https://pytorch.org"
       },
       "image": "../_static/img/pytorch_seo.png",
       "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "/intermediate/optimizer_step_in_backward_tutorial.html"
       },
       "datePublished": "2023-01-01T00:00:00Z",
       "dateModified": "2023-01-01T00:00:00Z"
     }
 </script>
  <script>
    // Tutorials Call to action event tracking
    $("[data-behavior='call-to-action-event']").on('click', function () {
      fbq('trackCustom', "Download", {
        tutorialTitle: $('h1:first').text(),
        downloadLink: this.href,
        tutorialLink: window.location.href,
        downloadTitle: $(this).attr("data-response")
      });
      if (typeof gtag === 'function') {
        gtag('event', 'click', {
          'event_category': $(this).attr("data-response"),
          'event_label': $("h1").first().text(),
          'tutorial_link': window.location.href
        });
      }
    });
  </script>
  
  </body>
</html>